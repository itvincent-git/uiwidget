;(function($){$.uiwidget=$.uiwidget||{};$.uiwidget.Navigator4=function(el,cfg){$.extend(this,cfg);this.el=$(el);this.hrefTarget=cfg.hrefTarget;this.loadData();this.init();if(this.autoRender){this.render()}};$.uiwidget.Navigator4.prototype={data:[],url:'',hrefTarget:null,autoRender:true,autoMax:true,maxDiv:null,minDiv:null,maxButton:null,foldButton:null,currentSelectId:null,init:function(){var parentDiv=$("<div></div>").attr("class","nav4");this.el.append(parentDiv);this.createMaxDiv();parentDiv.append(this.maxDiv);this.createMinDiv();parentDiv.append(this.minDiv);if(this.autoMax)this.minDiv.hide();else this.maxDiv.hide();this.maxButton.bind("click",{nav:this},this.maximize);this.foldButton.bind("click",{nav:this},this.minimize)},maximize:function(e){var nav=e.data.nav;nav.getMaxDiv().show();nav.getMinDiv().hide();nav.triggerHandler('navresize',[])},minimize:function(e){var nav=e.data.nav;nav.getMinDiv().show();nav.getMaxDiv().hide();nav.triggerHandler('navresize',[])},createMinDiv:function(){this.minDiv=$("<div></div>").attr("class","nav-min");this.renderMaxButton();this.minDiv.append($("<ul></ul>"))},createMaxDiv:function(){this.maxDiv=$("<div></div>").attr("class","nav-max");this.renderFoldButton();this.maxDiv.append($("<ul></ul>"))},getMaxDiv:function(){return this.maxDiv},getMinDiv:function(){return this.minDiv},renderMaxButton:function(){var input=$("<input/>").attr("type","button").attr("title","展开菜单").attr("class","fold-button-right").attr("hideFocus","true");this.maxButton=input;this.minDiv.append(input)},renderFoldButton:function(){var input=$("<input/>").attr("type","button").attr("title","收起菜单").attr("class","fold-button-left").attr("hideFocus","true");this.foldButton=input;this.maxDiv.append(input)},renderMin:function(){var ul=this.minDiv.find("ul");for(var i=0;i<this.data.length;i++){var text=this.data[i].text;var minIconClass=this.data[i].minIconClass;if(this.data[i].children!=null){for(var j=0;j<this.data[i].children.length;j++){var secondText=this.data[i].children[j].text;var secondMinIconClass=this.data[i].children[j].minIconClass;var secondLi=this.createMinLi(this.data[i].children[j],secondMinIconClass);secondLi.bind("click",{data:this.data[i].children[j],nav:this,li:secondLi},this.clickMinNav);ul.append(secondLi)}}else{var li=this.createMinLi(this.data[i],minIconClass);li.bind("click",{data:this.data[i],nav:this,li:li},this.clickMinNav);ul.append(li)}}},renderMax:function(){var ul=this.maxDiv.find("ul");for(var i=0;i<this.data.length;i++){var iconClass=this.data[i].iconClass;if(iconClass==null)iconClass="";if(this.data[i].children!=null){var li=$("<li></li>").attr("class","nav-item-group").attr("id",this.data[i].id+"-max").html(this.data[i].text);ul.append(li);li.bind("click",{li:li,dataI:this.data[i],nav:this},this.clickMaxFirstNav);this.createMaxSecondNav(this.data[i],li)}else{var li=$("<li></li>").attr("class","nav-item").attr("id",this.data[i].id+"-max");var input=$("<input/>").attr("type","button").attr("title",this.data[i].text).attr("class","nav-item-icon "+iconClass).attr("hideFocus","true");var span=$("<span></span>").attr("class","nav-item-text").html(this.data[i].text);li.bind("click",{li:li,dataI:this.data[i],nav:this},this.clickMaxFirstNav);li.append(input);li.append(span);ul.append(li)}}},replaceBlank:function(string,reg){return string.replace(reg,"")},setSelectedCss:function(id){var min=$("#"+id+"-min");min.attr("class",min.attr("class")+" nav-item-on");var max=$("#"+id+"-max");max.attr("class",max.attr("class")+" nav-item-on")},setUnSelectedCss:function(id){var min=$("#"+id+"-min");min.attr("class","nav-item");var max=$("#"+id+"-max");max.attr("class","nav-item")},createMinLi:function(dataI,minIconClass){var li=$("<li></li>").attr("class","nav-item").attr("id",dataI.id+"-min");var input=$("<input/>").attr("type","button").attr("title",dataI.text).attr("class","nav-item-icon "+minIconClass).attr("hideFocus","true");li.append(input);return li},createMaxSecondNav:function(dataI,li){var ul=$("<ul></ul>").attr("style","display:block");li.append(ul);for(var i=0;i<dataI.children.length;i++){var iconClass=dataI.children[i].iconClass;var text=dataI.children[i].text;var secondLi=$("<li></li>").attr("class","nav-item").attr("id",dataI.children[i].id+"-max");var input=$("<input/>").attr("type","button").attr("title",dataI.children[i].text).attr("class","nav-item-icon "+iconClass).attr("hideFocus","true");var span=$("<span></span>").attr("class","nav-item-text").html(text);secondLi.bind("click",{li:secondLi,dataI:dataI.children[i],nav:this},this.clickMaxSecondNav);secondLi.append(input);secondLi.append(span);ul.append(secondLi)}},clickMinNav:function(e){var nav=e.data.nav;var li=e.data.li;var data=e.data.data;if(data.children==null){if(data.href!=null)$("#"+nav.hrefTarget).page(data.href);if(nav.currentSelectId!=null)nav.setUnSelectedCss(nav.currentSelectId);nav.currentSelectId=nav.replaceBlank(li.attr("id"),"-min");nav.setSelectedCss(nav.currentSelectId)}nav.triggerHandler('itemclick',[data])},clickMaxFirstNav:function(e){var nav=e.data.nav;var data=e.data.dataI;var li=e.data.li;if(data.children!=null){var ul=li.find("ul");if(li.attr("class")=="nav-item-group"){li.attr("class","nav-item-group-folded");ul.attr("style","display:none")}else{li.attr("class","nav-item-group");ul.attr("style","display:block")}nav.triggerHandler('navresize',[])}else{if(data.href!=null)$("#"+nav.hrefTarget).page(data.href);if(nav.currentSelectId!=null)nav.setUnSelectedCss(nav.currentSelectId);nav.currentSelectId=nav.replaceBlank(li.attr("id"),"-max");nav.setSelectedCss(nav.currentSelectId)}nav.triggerHandler('itemclick',[data])},clickMaxSecondNav:function(e){e.stopPropagation();var nav=e.data.nav;var li=e.data.li;li.attr("class",li.attr("class")+" nav-item nav-item-on");var data=e.data.dataI;if(data.href!=null)$("#"+nav.hrefTarget).page(data.href);if(nav.currentSelectId!=null)nav.setUnSelectedCss(nav.currentSelectId);nav.currentSelectId=nav.replaceBlank(li.attr("id"),"-max");nav.setSelectedCss(nav.currentSelectId);nav.triggerHandler('itemclick',[data])},render:function(){this.renderMax();this.renderMin()},renderMenu:function(items){},getFoldButton:function(){return this.foldButton},getMaxButton:function(){return this.maxButton},getHeight:function(){if(this.maxDiv.is(":hidden")){return this.minDiv.attr("scrollHeight")}else{return this.maxDiv.attr("scrollHeight")}},getWidth:function(){if(this.maxDiv.is(":hidden")){return this.minDiv.attr("offsetWidth")}else{return this.maxDiv.attr("offsetWidth")}},isMax:function(){return!this.maxDiv.is(":hidden")},loadData:function(){var t=this;if(this.url!=""){$.ajax({async:false,cache:this.cache,dataType:'json',type:'POST',url:this.url,data:this.loadParas,timeout:this.timeout||60000,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(data){t.data=data||[]}})}},getData:function(){return this.data},bind:function(arg0,arg1,arg2){arg0=arg0.toLowerCase();if(typeof arg1=='object')return this.el.bind(arg0,arg1,arg2);else return this.el.bind(arg0,arg1)},trigger:function(arg0,arg1){return this.el.trigger(arg0,arg1)},triggerHandler:function(type,data,srcEvent){type=type.toLowerCase();if(srcEvent){if(this.el[0]){var event=srcEvent;event.type=type;event.triggerTarget=event.target;event.stopPropagation();$.event.trigger(event,data,this.el[0],false);return event.result}}else{return this.el.triggerHandler(type,data)}},select:function(id){var data=this.getDataById(id);if(data.href!=null)$("#"+this.hrefTarget).page(data.href);if(this.currentSelectId!=null)this.setUnSelectedCss(this.currentSelectId);this.currentSelectId=id;this.setSelectedCss(this.currentSelectId);this.triggerHandler('itemclick',[data])},getDataById:function(id){for(var i=0;i<this.data.length;i++){if(this.data[i].id==id){return this.data[i]}else{if(this.data[i].children!=null){var children=this.data[i].children;for(var j=0;j<children.length;j++){if(children[j].id==id){return children[j]}}}}}}};$.fn.navigator4=function(cfg){return new $.uiwidget.Navigator4(this,cfg)}})(jQuery);