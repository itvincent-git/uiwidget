/**
* Grid×é¼þ
*
* @author Vincent (zhongyongsheng@300.cn)
* @date 2010-05-12
* @version 3.0.0-BETA1
*/
(function(d){d.uiwidget=d.uiwidget||{};d.uiwidget.Class=d.uiwidget.Class||{create:function(a){function b(){this.initialize.apply(this,arguments)}d.extend(b.prototype,a);if(!b.prototype.initialize)b.prototype.initialize=function(){};return b.prototype.constructor=b}};d.uiwidget.isIE=!!window.ActiveXObject;d.uiwidget.isIE6=d.uiwidget.isIE&&!window.XMLHttpRequest;d.uiwidget.isIE8=d.uiwidget.isIE&&!!document.documentMode;d.uiwidget.isIE7=d.uiwidget.isIE&&!d.uiwidget.isIE6&&!d.uiwidget.isIE8;d.uiwidget.BLANK_IMAGE_URL=
d.uiwidget.isIE6||d.uiwidget.isIE7?"images/s2.gif":"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";d.uiwidget.Grid=function(a,b){d.extend(this,b);this.grid=a;this.init();this.render()};d.uiwidget.Grid.prototype={pageNumberText:"\u9875\u7801\uff1a",jumperText:"\u8df3\u5230",firstText:"\u9996\u9875",prevText:"\u524d\u4e00\u9875",nextText:"\u4e0b\u4e00\u9875",lastText:"\u672b\u9875",emptyMsg:"\u6ca1\u6709\u8bb0\u5f55",displayMsg:"\u663e\u793a {0} - {1}\u6761\uff0c\u5171 {2} \u6761",
pageSizeListText:"\u663e\u793a\u6761\u6570\uff1a",height:375,cm:[],data:{totalCount:0,result:[]},displayHeader:true,autoLoad:true,defaultLineHeight:25,scrollOffsetWidth:17,cache:false,cellBorder:1,checkboxWidth:27,init:function(){this.initParas();var a=this;d.each(["beforeRender","afterRender","headerCheckboxClick"],function(b,c){a[c]&&a.bind(c,a[c])});this.cacheData=this.data;this.sm=this.sm||new d.uiwidget.RowSelectionModel;this.sm.grid=this;this.pageToolbar=this.pageToolbar||new d.uiwidget.ComplexPageToolbar;
this.pageToolbar.grid=this;this.rowBuilder=this.rowBuilder||new d.uiwidget.GridRowBuilder;this.rowBuilder.grid=this},initParas:function(){this.paras={};if(this.defaultSort){this.paras.sort=this.defaultSort.field;this.paras.dir=this.defaultSort.direction}if(this.pageSize){this.paras.start=0;this.paras.limit=this.pageSize}d.extend(this.paras,this.baseParams)},render:function(){var a=this;this.container=d(['<div class="grid-container"><div class="grid-main-wrap"><div class="grid-mainhead-wrap"><div class="grid-mainhead-scroller"><table class="grid-hd-table" cellspacing="0" cellpadding="0"><tbody></tbody></table></div></div><div class="grid-mainbody-wrap"  style="height:',
this.height,'px;"><div class="grid-mainbody grid-mainbody-scroller"></div></div></div></div>'].join(""));this.grid.append(this.container);this.mainWrap=this.container.children(".grid-main-wrap");this.mainHeadWrap=this.mainWrap.children(".grid-mainhead-wrap");this.mainHeadTable=this.mainHeadWrap.find(".grid-hd-table");this.mainBodyWrap=this.mainWrap.children(".grid-mainbody-wrap");this.mainBody=this.mainBodyWrap.find(".grid-mainbody");this.fitAutoSize();if(this.displayHeader){this.customHeader?this.renderCustomHeader():
this.renderHeader();this.headerTd=this.mainHeadTable.find("td");this.headerCb=this.mainHeadTable.find(".grid-header-checkbox");this.addHeaderEvent()}this.renderEditor();this.pageSize&&this.pageToolbar.renderToolbar();if(this.showSummaryBar)if(d.uiwidget.SummaryBar)this.summaryBar=new d.uiwidget.SummaryBar(this);this.mainBodyWrap.bind("scroll",function(){var b=d(this),c=b.scrollLeft();b=b.scrollTop();a.mainHeadWrap.scrollLeft(c);a.triggerHandler("bodyscroll",[a,c,b])});this.sm.initEvent();this.autoLoad&&
this.loadData();this.mainHeadTable.width(this.getTotalColumnWidth());this.mainBody.width(this.getTotalColumnWidth());this.triggerHandler("rendered",[this])},fitAutoSize:function(){this.grid.width(this.grid.width());for(var a=0;a<this.cm.length;a++)if(this.cm[a].width&&typeof this.cm[a].width=="string"&&this.cm[a].width.indexOf("%")!=-1){var b=this.cm[a].width.indexOf("%");b=Number(this.cm[a].width.substring(0,b));b=parseInt(this.getInnerWidth()*b/100);this.cm[a].width=String(b+"px")}else if(this.cm[a].checkbox)this.cm[a].width=
String(this.checkboxWidth+"px");else if(!this.cm[a].width)var c=a;if(c!=undefined){a=this.getInnerWidth();for(b=0;b<this.cm.length;b++)if(this.cm[b].width)a-=this.cm[b].width.substring(0,this.cm[b].width.length-2);this.cm[c].width=String(a-2+"px")}},getTotalWidth:function(){return this.container.width()},getInnerWidth:function(){return this.getTotalWidth()-this.scrollOffsetWidth},buildHeadRow:function(a,b){for(var c=[],e=0;e<a.length;e++){var f=a[e];if(f.checkbox)c.push("<td ",f.row?" rowspan="+f.row:
"",f.col?" colspan="+f.col:"",f.hidden?' style="display:none"':"",b?"":' style="width:'+f.width+'"',' class="grid-hd-chk"><div class="grid-inner"><span><input type="checkbox" class="grid-header-checkbox"></span>');else{c.push("<td ",f.row?" rowspan="+f.row:"",f.col?" colspan="+f.col:"",f.hidden?' style="display:none"':"",b?"":' style="width:'+f.width+'"',' class="grid-cm-',f.dataIndex," grid-header-",f.dataIndex,'">');c.push('<div class="grid-inner"');if(f.width&&!b)if(typeof f.width=="string"){var g=
f.width.indexOf("px");g=Number(f.width.substring(0,g))-8;c.push(' style="width:',g,'px;"')}else c.push(' style="width:',f.width,'"');c.push(' title="',f.title==undefined?f.header:f.title,'"');c.push(' unselectable="on">',f.header);f.icon&&c.push('<img class="grid-hd-icon" src="',f.icon,'"/>')}c.push('<div class="grid-hd-tool">');f.sortable!==false&&!f.checkbox&&c.push('<span class="grid-hd-sort"></span>');c.push('<span class="grid-hd-split"></span>');c.push("</div>");c.push("</div></td>")}return c},
renderCustomHeader:function(){var a=[],b=this;a=['<tr class="grid-hd-row grid-hd-row-hidden">'];a=a.concat(this.buildHeadRow(this.cm));a.push("</tr>");d.each(this.customHeader,function(c,e){a.push('<tr class="grid-hd-row">');a=a.concat(b.buildHeadRow(e,true));a.push("</tr>")});this.mainHeadWrap.find("tbody").append(a.join(""))},renderHeader:function(){var a=['<tr class="grid-hd-row">'];a=a.concat(this.buildHeadRow(this.cm));a.push("</tr>");this.mainHeadWrap.find("tbody").append(a.join(""))},renderEditor:function(){var a=
this;a.focus=d('<a class="grid-focus" tabindex="-1" href="#"/>');a.mainBodyWrap.append(a.focus);d.each(this.cm,function(b,c){if(c.editor){if(typeof c.editor=="string")c.editor={html:c.editor};if(typeof c.editor=="object"){b=c.editor;if(b.type)if(b.type=="text"){var e="grid-editor-"+c.dataIndex;b.html=['<input id="',e,'" class="',e," ",b.cls,'" type="text" />'].join("")}else if(b.type=="date"){e="grid-editor-"+c.dataIndex;b.html=d(['<input id="',e,'" class="',e," ",b.cls,'" type="text" />'].join(""));
a.grid.append(b.html);Calendar.setup({inputField:b.html[0],ifFormat:"%Y-%m-%d",button:b.html[0]});b.startEdit=function(f,g){g.getEditEl()[0].onclick()}}c.editor=a.mainBodyWrap.editor({field:b.html});c.editor.bind("onComplete",function(f,g){f=g.bindEl;a.doFocus();var h=a.findRowIndex(a.findParentRow(f)),i=a.getDataIndex(f.parents("td")[0]);a.data.result[h][i]=g.getValue();a.addTitle(f,g.getValue());if(a.sm.activateEditor)a.sm.activateEditor=null});c.editor.bind("onCancel",function(){a.doFocus()});
b.startEdit&&c.editor.bind("startEdit",b.startEdit);b.beforeComplete&&c.editor.bind("beforeComplete",b.beforeComplete);b.onComplete&&c.editor.bind("onComplete",b.onComplete);b.onCancel&&c.editor.bind("onCancel",b.onCancel)}}})},doFocus:function(){if(d.browser.mozilla)d.defer(function(){this.focus.css("top",this.getScrollPos());this.focus.focus()},1,this);else{this.focus.css("top",this.getScrollPos());this.focus.focus()}},addTitle:function(a,b){a.attr("title",b)},addHeaderEvent:function(){this.mainHeadTable.delegate("td:has(.grid-hd-sort)",
"mouseover",{grid:this},function(a){d(this).addClass("grid-hd-over");a.data.grid.triggerHandler("headerMouseover",[this])});this.mainHeadTable.delegate("td:has(.grid-hd-sort)","mouseout",{grid:this},function(a){d(this).removeClass("grid-hd-over");a.data.grid.triggerHandler("headerMouseout",[this])});this.mainHeadTable.delegate("td:has(.grid-hd-sort)","click",{grid:this},function(a){var b=d(this).find(".grid-hd-sort"),c=a.data.grid;if(b.hasClass("grid-hd-asc")){c.paras.dir="DESC";c.sortHeadTd&&c.sortHeadTd.removeClass("grid-hd-asc grid-hd-desc");
b.addClass("grid-hd-desc")}else{c.paras.dir="ASC";c.sortHeadTd&&c.sortHeadTd.removeClass("grid-hd-asc grid-hd-desc");b.addClass("grid-hd-asc")}c.sortHeadTd=b;c.paras.sort=c.getDataIndex(this);a.data.grid.triggerHandler("headerClick",[this]);c.loadData()});this.mainHeadTable.delegate(".grid-header-checkbox","click",{grid:this},function(a){a=a.data.grid;a.triggerHandler("headerCheckboxClick",[a,d(this)])})},getDataIndex:function(a){return a.className.split(" ")[1].split("-")[2]},loadData:function(a){this.sm.selections&&
this.sm.selections.clear();this.updateHeaderCheckbox();if(this.url){var b=this;d.ajax({dataType:"json",type:"POST",url:this.url,data:this.paras,cache:this.cache,timeout:this.timeout||6E4,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(c){b.data=c;a&&a.call(b);b.renderData()}})}else{this.setDataFromCache();a&&a.call(this);this.renderData()}},setDataFromCache:function(){if(this.pageSize&&this.cacheData.result.length>this.pageSize){var a=(this.getPageNumber()-1)*this.pageSize;
this.setData({totalCount:this.cacheData.totalCount,result:this.cacheData.result.slice(a,a+this.pageSize)})}},reloadInsertBefore:function(a,b){this.loadInit(function(){this.insertDataBefore(a,b)})},insertRecordsBefore:function(a,b){this.insertDataBefore(a,b);this.renderData()},insertDataBefore:function(a,b){if(typeof a==="string")a=eval("("+a+")");if(a.totalCount)a=a.result;else if(!a.length){var c=[];c.push(a);a=c}this.filterData(a,b);for(b=0;b<a.length;b++)this.data.result.unshift(a[b]);if(this.pageSize)if(this.data.result.length>
this.pageSize)this.data.result=this.data.result.slice(0,this.pageSize)},filterData:function(a,b){b||(b=function(h,i){if(h.id==i.id)return true});for(var c=[],e=0;e<a.length;e++)for(var f=0,g=this.data.result.length;f<g;f++)b.call(this,this.data.result[f],a[e])&&c.push(this.data.result[f]);for(e=0;e<c.length;e++)this.data.result.splice(jQuery.inArray(c[e],this.data.result),1)},renderData:function(){this.triggerHandler("beforeRender",[this]);if(this.data&&this.data.result){for(var a=[],b=0;b<this.data.result.length;b++)a=
a.concat(this.rowBuilder.buildRow(b,this.data.result[b]));this.mainBody.empty().append(a.join(""));if(this.data.result.length<1){this.showEmptyText();d.uiwidget.isIE&&this.mainBody.hide()}else{this.hideEmptyText();d.uiwidget.isIE&&this.mainBody.show()}}this.pageSize&&this.pageToolbar.updateToolbar();this.triggerHandler("afterRender",[this])},isOverHeight:function(){return this.mainBody.height()>this.mainBodyWrap.height()},isOverWidth:function(){return this.mainBody.find(".grid-bd-table").width()>
this.mainBodyWrap.width()},getTotalColumnWidth:function(){if(!this.totalColumnWidth)for(var a=this.totalColumnWidth=0,b=this.cm.length;a<b;a++)this.cm[a].hidden||(this.totalColumnWidth+=this.getColumnWidth(a));return this.totalColumnWidth},getColumnWidth:function(a){var b=this.cm[a].width;if(b){if(typeof b=="string"){a=b.indexOf("px");b=Number(b.substring(0,a))}}else b=this.cm[a].checkbox?29:0;return b},showEmptyText:function(){this.mainBody.after(this.emptyText||(this.emptyText=d('<div class="grid-empty-text">'+
this.emptyMsg+"</div>")));this.emptyText.show()},hideEmptyText:function(){this.emptyText&&this.emptyText.hide()},updateHeaderCheckbox:function(){if(this.sm.selections&&this.data.result.length!=0&&this.sm.selections.getCount()==this.data.result.length)this.headerCb&&this.headerCb.attr("checked",true);else this.headerCb&&this.headerCb.attr("checked",false)},goPage:function(a){if(a){this.pageNumber=a;this.paras.start=(a-1)*this.pageSize}else this.pageNumber=0;this.loadData()},getPageNumber:function(){return this.pageNumber||
(this.pageNumber=1)},getPageSize:function(){return this.pageSize},getSelections:function(){return this.sm.getSelections()},getData:function(){return this.data},setData:function(a){this.data=a},getResult:function(){return this.getData().result},reload:function(){this.loadData()},load:function(){this.loadData()},loadInit:function(a){this.initParas();this.loadData(a);this.headerTd.find(".grid-hd-sort").removeClass("grid-hd-asc grid-hd-desc")},query:function(a){d.extend(this.paras,{start:0,limit:this.pageSize});
d.extend(this.paras,a);this.loadData()},search:this.query,setPageSize:function(a){this.pageSize=this.paras.limit=a},getSelectionModel:function(){return this.sm},moveTop:function(a){var b=this.getRow(a);if(a!=0){var c=this.getFirstRow();this.data.result.splice(0,0,this.data.result.splice(a,1)[0]);c.before(b)}},moveUp:function(a){var b=this.getRow(a);if(a!=0){var c=this.findPrevRow(b),e=a-1;a=this.data.result.splice(a,1)[0];this.data.result.splice(e,0,a);c.before(b)}},moveDown:function(a){var b=this.getRow(a);
if(a!=this.data.result.length-1){var c=this.findNextRow(b),e=a+1;a=this.data.result.splice(a,1)[0];this.data.result.splice(e,0,a);c.after(b)}},moveBottom:function(a){var b=this.getRow(a);if(a!=this.data.result.length-1){var c=this.getLastRow(),e=this.data.result.length-1;a=this.data.result.splice(a,1)[0];this.data.result.splice(e,0,a);c.after(b)}},appendRow:function(a){this.hideEmptyText();if(a.length)for(var b=0;b<a.length;b++)this.mainBody.append(d(this.rowBuilder.buildRow(this.data.result.length+
b,a[b]).join("")));else this.appendRow([].concat(a));this.data.result=d.merge(this.data.result,a);this.pageSize&&this.pageToolbar.updateToolbar()},replaceRow:function(a,b){var c=this.getRow(a);this.data.result[a]=d.extend(this.data.result[a],b);a=d(this.rowBuilder.buildRow(a,this.data.result[a]).join("")).children();c.empty();c.append(a);this.sm.isSelected(c)?this.sm.select(c,true):this.sm.deselect(c,true)},removeRow:function(a){var b=this;a=this.getRow(a);this.sm.deselect(a,true);a.each(function(){var c=
d(this);b.data.result.splice(b.findRowIndex(c),1);c.remove()});this.data.result.length<1&&this.showEmptyText();this.pageSize&&this.pageToolbar.updateToolbar()},findRowIndex:function(a){return this.mainBody.children(".grid-row").index(a.nodeType?a:a[0])},findCellIndex:function(a){return d(a).parent(".grid-bd-row").find("td").index(a.nodeType?a:a[0])},findRowData:function(a){return this.data.result[this.findRowIndex(a)]},findCellData:function(a){var b=this,c=b.findCellIndex(a);a=b.findRowIndex(b.findParentRow(a));
r=b.data.result[a];return{result:r,rowIndex:a,colIndex:c,value:r[b.cm[c].dataIndex]}},getAllRow:function(){return this.mainBody.children(".grid-row")},getRow:function(a){return this.mainBody.children(".grid-row:eq("+a+")")},getCell:function(a,b){return this.getRow(a).find("td").eq(b)},findParentRow:function(a){return a.parents(".grid-row")},findParentCell:function(a){return a.is("[class*=grid-row-td]")?a:a.parents("[class*=grid-row-td]")},getFirstRow:function(){return this.mainBody.find(".grid-row:first")},
getLastRow:function(){return this.mainBody.find(".grid-row:last")},findPrevRow:function(a){return a.prev(".grid-row")},findNextRow:function(a){return a.next(".grid-row")},bind:function(a,b,c){a=a.toLowerCase();return typeof b=="object"?this.grid.bind(a,b,c):this.grid.bind(a,b)},trigger:function(a,b){return this.grid.trigger(a,b)},triggerHandler:function(a,b,c){a=a.toLowerCase();if(c){if(this.grid[0]){c.type=a;c.triggerTarget=c.target;c.stopPropagation();d.event.trigger(c,b,this.grid[0],false);return c.result}}else return this.grid.triggerHandler(a,
b)},getHeight:function(){return this.height},setHeight:function(a){this.mainBodyWrap.height(this.height=a)},getLineHeight:function(){return this.lineHeight||(this.lineHeight=this.mainBody.children("tr").height())||this.defaultLineHeight},scrollTo:function(a){this.mainBodyWrap.scrollTop(a)},getScrollPos:function(){return this.mainBodyWrap.scrollTop()},getScrollArea:function(){return this.mainBodyWrap.height()},scrollToRow:function(a){var b=this.getRow(a);a=this.getScrollPos();var c=this.getScrollArea(),
e=b.position().top;b=e+b.height();if(e<a)this.scrollTo(e);else b>a+c&&this.scrollTo(b-c)}};d.uiwidget.RowSelectionModel=function(a){d.extend(this,a)};d.uiwidget.RowSelectionModel.prototype={initEvent:function(){var a=this.grid,b=this;d.each(["beforeRowSelect","rowSelect","rowDblclick","rowDeselect","rowCheckboxClick","rowmouseenter","rowmouseleave","rowContextMenu"],function(c,e){a[e]&&a.bind(e,a[e])});this.addRowEvent();this.selections=new d.uiwidget.Collection;a.bind("headerCheckboxClick",function(c,
e,f){d(f).attr("checked")?b.selectAll():b.deselectAll()})},addRowEvent:function(){var a=this,b=this.grid;b.mainBody.delegate(":checkbox.grid-body-checkbox","click",function(c){c.stopPropagation();c=d(this);var e=b.findParentRow(c);a.isSelected(e)?a.deselect(e,true):a.select(e,true);b.triggerHandler("rowCheckboxClick",[b,e,c])});b.mainBody.delegate(".grid-row","click",function(c){c.stopPropagation();c=d(this);a.select(c)});b.mainBody.delegate(".grid-row","mouseenter",function(){var c=d(this);c.addClass("grid-row-over");
b.triggerHandler("rowmouseenter",[b,c])});b.mainBody.delegate(".grid-row","mouseleave",function(){var c=d(this);c.removeClass("grid-row-over");b.triggerHandler("rowmouseleave",[b,c])});b.mainBody.delegate(".grid-row","dblclick",function(){var c=d(this);b.triggerHandler("rowDblclick",[b,c])});b.mainBody.delegate(".grid-row","contextmenu",function(c){c.preventDefault();var e=d(this);b.triggerHandler("rowContextMenu",[b,e],c)});b.mainBodyWrap.keydown(function(c){a.handlerKeyDown(c)})},selectRow:function(a,
b,c){return this.select(this.grid.getRow(a),b,c)},deselectRow:function(a,b,c){return this.deselect(this.grid.getRow(a),b,c)},select:function(a,b,c){if(this.grid.triggerHandler("beforerowselect",[this.grid,a])!==false){b||this.clearSelections();a.addClass("grid-row-selected").find(":checkbox.grid-body-checkbox").attr("checked",true);this.lastSelection=a;this.selections.add(a[0]);c||this.grid.updateHeaderCheckbox();this.grid.triggerHandler("rowselect",[this.grid,a])}},deselect:function(a,b,c){b||this.clearSelections();
a.removeClass("grid-row-selected").find(":checkbox.grid-body-checkbox").attr("checked",false);this.selections.remove(a[0]);c||this.grid.updateHeaderCheckbox();this.grid.triggerHandler("rowdeselect",[this.grid,a])},clearSelections:function(){this.selections.each(function(a){this.deselect(d(a),true,true)},this)},selectAll:function(){var a=this;this.grid.getAllRow().each(function(b,c){a.select(d(c),true,true)});this.grid.updateHeaderCheckbox()},deselectAll:function(){var a=this;this.grid.getAllRow().each(function(b,
c){a.deselect(d(c),true,true)});this.grid.updateHeaderCheckbox()},isSelected:function(a){return a.hasClass("grid-row-selected")},getSelections:function(){var a=this.grid,b=[];this.selections.each(function(){b.push(a.findRowData(d(this)))});return b},getSelectedIndexs:function(){var a=this.grid,b=[];this.selections.each(function(){b.push(a.findRowIndex(d(this)))});return b},hasSelection:function(){return this.selections.getCount()>0},handlerKeyDown:function(a){a.stopPropagation();a.preventDefault();
a=a.which;if(this.lastSelection){var b=this.grid.findRowIndex(this.lastSelection);if(a==38)this.goRows(b-1,1);else a==40&&this.goRows(b+1,1)}},goRows:function(a){if(!(a<0||a>this.grid.data.result.length-1)){var b=this.grid.getRow(a);if(b.length<1)this.goRows(--a,1);else{this.select(b);this.grid.scrollToRow(a)}}}};d.uiwidget.CellSelectionModel=function(a){d.extend(this,a)};d.uiwidget.CellSelectionModel.prototype={initEvent:function(){var a=this.grid;d.each(["beforeCellSelect","cellSelect","cellDeselect",
"cellDblclick","cellContextMenu"],function(b,c){a[c]&&a.bind(c,a[c])});this.addEvent();this.selections=new d.uiwidget.Collection},addEvent:function(){var a=this,b=this.grid;b.mainBody.delegate(".grid-row-td","click",function(c){c.stopPropagation();c=d(this);a.select(c)});b.mainBody.delegate(".grid-row-td","dblclick",function(){var c=d(this);b.triggerHandler("cellDblclick",[b,c])});b.mainBody.delegate(".grid-row-td","contextmenu",function(c){c.preventDefault();var e=d(this);b.triggerHandler("cellContextMenu",
[b,e],c)});b.mainBodyWrap.keydown(function(c){a.handlerKeyDown(c)})},selectCell:function(a,b,c){return this.select(this.grid.getCell(a,b),c)},deselectCell:function(a,b,c){return this.deselect(this.grid.getCell(a,b),c)},select:function(a,b){if(this.grid.triggerHandler("beforecellselect",[this.grid,a])!==false){b||this.clearSelections();a.addClass("grid-cell-selected");this.lastSelection=a;this.selections.add(a[0]);this.grid.triggerHandler("cellselect",[this.grid,a])}},deselect:function(a,b){b||this.clearSelections();
a.removeClass("grid-cell-selected");this.selections.remove(a[0]);this.grid.triggerHandler("celldeselect",[this.grid,a])},clearSelections:function(){this.selections.each(function(a){this.deselect(d(a),true,true)},this)},selectAll:function(){var a=this;this.grid.getAllRow().each(function(b,c){a.select(d(c),true,true)});this.grid.updateHeaderCheckbox()},deselectAll:function(){var a=this;this.grid.getAllRow().each(function(b,c){a.deselect(d(c),true,true)});this.grid.updateHeaderCheckbox()},isSelected:function(a){return a.hasClass("grid-cell-selected")},
getSelections:function(){var a=this.grid,b=[];this.selections.each(function(){var c=d(this),e=a.findCellIndex(c);c=a.findRowIndex(a.findParentRow(c));r=a.data.result[c];b.push({result:r,rowIndex:c,colIndex:e,value:r[a.cm[e].dataIndex]})});return b},hasSelection:function(){return this.selections.getCount()>0},handlerKeyDown:function(a){a.stopPropagation();a.preventDefault();a=a.which;var b=this.getSelections()[0];if(b){var c=b.rowIndex;b=b.colIndex;if(a==13)this.startEditing&&this.startEditing(c,b);
else if(a==9)this.goCells(c,b+1,1);else if(a==37)this.goCells(c,b-1,1);else if(a==39)this.goCells(c,b+1,1);else if(a==38)this.goCells(c-1,b,1);else a==40&&this.goCells(c+1,b,1)}},goCells:function(a,b){if(a<0)a=0;if(b<0)b=0;var c=this.grid.getRow(a);if(c.length<1)this.goCells(--a,b,1);else{c=c.find(".grid-row-td").eq(b);if(c.length<1)this.goCells(a,--b,1);else{this.select(c);this.grid.scrollToRow(a)}}}};d.uiwidget.EditCellSelectionModel=function(a){d.extend(this,a)};d.uiwidget.EditCellSelectionModel.prototype=
{initEvent:function(){var a=this.grid,b=this;d.each(["beforeCellSelect","cellSelect","cellDblclick","beforeRowSelect","rowSelect","rowDblclick","rowDeselect","rowCheckboxClick"],function(c,e){a[e]&&a.bind(e,a[e])});this.addEvent();this.selections=new d.uiwidget.Collection;this.cellSelections=new d.uiwidget.Collection;a.bind("headerCheckboxClick",function(c,e,f){d(f).attr("checked")?b.selectAll():b.deselectAll()});a.bind("bodyscroll",function(c,e){e.sm.stopEditing()})},addEvent:function(){var a=this,
b=this.grid;b.mainBody.delegate(".grid-row-td","click",function(c){var e=d(this);a.selectc(e);a.onAutoEditClick(c,e)});b.mainBody.delegate(".grid-row","click",function(c){c.stopPropagation();c=d(this);a.select(c)});b.mainBody.delegate(":checkbox.grid-body-checkbox","click",function(c){c.stopPropagation();c=d(this);var e=b.findParentRow(c);a.isSelected(e)?a.deselect(e,true):a.select(e,true);b.triggerHandler("rowCheckboxClick",[b,e,c])});b.mainBody.delegate(".grid-row-td","dblclick",function(){var c=
d(this);b.triggerHandler("cellDblclick",[b,c])});b.mainBody.delegate(".grid-row","dblclick",function(){var c=d(this);b.triggerHandler("rowDblclick",[b,c])});b.mainBodyWrap.keydown(function(c){a.handlerKeyDown(c)})},selectCell:function(a,b,c){return this.selectc(this.grid.getCell(a,b),c)},deselectCell:function(a,b,c){return this.deselectc(this.grid.getCell(a,b),c)},selectRow:function(a,b,c){return this.select(this.grid.getRow(a),b,c)},deselectRow:function(a,b,c){return this.deselect(this.grid.getRow(a),
b,c)},select:function(a,b,c){if(this.grid.triggerHandler("beforerowselect",[this.grid,a])!==false){b||this.clearSelections();a.addClass("grid-row-selected").find(":checkbox.grid-body-checkbox").attr("checked",true);this.lastSelection=a;this.selections.add(a[0]);c||this.grid.updateHeaderCheckbox();this.grid.triggerHandler("rowselect",[this.grid,a])}},selectc:function(a,b){if(this.grid.triggerHandler("beforecellselect",[this.grid,a])!==false){b||this.clearCellSelections();a.addClass("grid-cell-selected");
this.cellSelections.add(a[0]);this.grid.triggerHandler("cellselect",[this.grid,a])}},deselect:function(a,b,c){b||this.clearSelections();a.removeClass("grid-row-selected").find(":checkbox.grid-body-checkbox").attr("checked",false);this.selections.remove(a[0]);c||this.grid.updateHeaderCheckbox();this.grid.triggerHandler("rowdeselect",[this.grid,a])},deselectc:function(a,b){b||this.clearSelections();a.removeClass("grid-cell-selected");this.cellSelections.remove(a[0]);this.grid.triggerHandler("celldeselect",
[this.grid,a])},clearSelections:function(){this.selections.each(function(a){this.deselect(d(a),true,true)},this)},clearCellSelections:function(){this.cellSelections.each(function(a){this.deselectc(d(a),true,true)},this)},selectAll:function(){var a=this;this.grid.getAllRow().each(function(b,c){a.select(d(c),true,true)});this.grid.updateHeaderCheckbox()},deselectAll:function(){var a=this;this.grid.getAllRow().each(function(b,c){a.deselect(d(c),true,true)});this.grid.updateHeaderCheckbox()},isSelected:function(a){return a.hasClass("grid-row-selected")},
getCellSelections:function(){var a=this.grid,b=[];this.cellSelections.each(function(){var c=d(this),e=a.findCellIndex(c);c=a.findRowIndex(a.findParentRow(c));r=a.data.result[c];b.push({result:r,rowIndex:c,colIndex:e,value:r[a.cm[e].dataIndex]})});return b},getSelections:function(){var a=this.grid,b=[];this.selections.each(function(){b.push(a.findRowData(d(this)))});return b},getSelectedIndexs:function(){var a=this.grid,b=[];this.selections.each(function(){b.push(a.findRowIndex(d(this)))});return b},
hasSelection:function(){return this.selections.getCount()>0},handlerKeyDown:function(a){a.stopPropagation();a.preventDefault();a=a.which;var b=this.getCellSelections()[0];if(b){var c=b.rowIndex;b=b.colIndex;if(a==13)this.startEditing&&this.startEditing(c,b);else if(a==9)this.goCells(c,b+1,1);else if(a==37)this.goCells(c,b-1,1);else if(a==39)this.goCells(c,b+1,1);else if(a==38)this.goCells(c-1,b,1);else a==40&&this.goCells(c+1,b,1)}},goCells:function(a,b){if(a<0)a=0;var c=this.grid.cm[0].checkbox?
1:0;if(b<c)b=c;c=this.grid.getRow(a);if(c.length<1)this.goCells(--a,b,1);else{c=c.find("td").eq(b);if(c.length<1)this.goCells(a,--b,1);else{this.selectc(c);this.grid.scrollToRow(a)}}},onAutoEditClick:function(a,b){a=this.grid;var c=a.findParentRow(b);c=a.findRowIndex(c);b=a.findCellIndex(b);this.startEditing(c,b)},startEditing:function(a,b){this.stopEditing();var c=this.grid;c.cm[b]&&c.cm[b].editor&&d.defer(function(){this.activateEditor=c.cm[b].editor;var e=c.getCell(a,b),f=e.find(".grid-inner"),
g=c.getDataIndex(e[0]);e=d.uiwidget.isIE?e.innerWidth():e.innerWidth()-c.cellBorder;c.cm[b].editor.startEdit(f,c.data.result[a][g]||"",{left:-c.cellBorder,top:-c.cellBorder,width:e})},50,this)},stopEditing:function(){if(this.activateEditor){this.activateEditor.completeEdit();this.activateEditor=null}}};d.uiwidget.NoSelectionModel=function(a){d.extend(this,a)};d.uiwidget.NoSelectionModel.prototype={initEvent:function(){var a=this.grid;d.each([,"rowmouseenter","rowmouseleave"],function(b,c){a[c]&&a.bind(c,
a[c])});this.addRowEvent()},addRowEvent:function(){var a=this.grid;a.mainBody.delegate(".grid-row","mouseenter",function(){var b=d(this);b.addClass("grid-row-over");a.triggerHandler("rowmouseenter",[a,b])});a.mainBody.delegate(".grid-row","mouseleave",function(){var b=d(this);b.removeClass("grid-row-over");a.triggerHandler("rowmouseleave",[a,b])})}};d.uiwidget.SummaryBar=function(a){this.grid=a;this.render()};d.uiwidget.SummaryBar.prototype={render:function(){var a=this;this.grid.bind("afterRender",
function(){a.update()});this.grid.bind("bodyscroll",function(b,c,e){a.summaryBar.scrollLeft(e)})},renderSummaryBar:function(){this.summaryBar=d('<div class="grid-summary-bar"><div class="grid-summary-bar-scroller"><table class="grid-summary-table" cellspacing="0" cellpadding="0"><tbody></tbody></table></div></div>');var a=this,b=this.grid;b.mainWrap.after(this.summaryBar);var c=[],e={};d.each(b.cm,function(g,h){if(!h.checkbox&&h.summaryConfig){if(h.summaryConfig.html)e[h.dataIndex]=h.summaryConfig.html;
if(h.summaryConfig.calculation)for(g=0;g<b.getResult().length;g++)if(typeof h.summaryConfig.calculation=="string")e[h.dataIndex]=d.uiwidget.Calculations[h.summaryConfig.calculation].call(b,e[h.dataIndex],h.dataIndex,g,b.getResult()[g])||0;else if(typeof h.summaryConfig.calculation=="function")e[h.dataIndex]=h.summaryConfig.calculation.call(b,e[h.dataIndex],h.dataIndex,g,b.getResult()[g])||0}});c.push('<tr class="grid-summary-row">');d.each(b.cm,function(g,h){if(h.checkbox)c.push('<td class="grid-summary-chk" unselectable="on" style="width:',
h.width?h.width:b.checkboxWidth+"px",'"></td>');else{g=e[h.dataIndex];if(typeof g=="number")g=h.precision!=undefined?e[h.dataIndex].toFixed(h.precision):e[h.dataIndex].toFixed(d.uiwidget.Calculations.defPrecision);c.push('<td class="grid-summary-bar-',h.dataIndex,'" hidefocus="true" width="',h.width,'" tabindex="1">');/<.*>/.exec(g)?c.push('<div unselectable="on">'):c.push('<div unselectable="on" title="',g,'">');c.push(g,"</div></td>")}});c.push("</tr>");this.summaryBar.find("tbody").append(c.join(""));
var f=b.mainBody.find(".grid-summary-table").width();f&&a.summaryBar.find(".grid-summary-table").width(f)},removeSummaryBar:function(){this.summaryBar&&this.summaryBar.remove()},update:function(){this.removeSummaryBar();this.renderSummaryBar()},getValue:function(a){return this.summaryBar.find(".grid-summary-bar-"+a+" div").attr("title")},setValue:function(a,b){a=this.summaryBar.find(".grid-summary-bar-"+a+" div");a.attr("title",b);a.html(b)}};d.uiwidget.PageToolbar=function(){};d.uiwidget.PageToolbar.prototype=
{renderToolbar:function(){var a=['<div class="grid-bottom-toolbar" cellpadding="0" cellspacing="0">'];if(this.grid.pageSizeList){for(var b=['<div class="page-size-list"><span class="page-size-list-text">',this.grid.pageSizeListText,'</span><select class="page-size-list-select">'],c=0;c<this.grid.pageSizeList.length;c++)b.push("<option value=",this.grid.pageSizeList[c],this.grid.pageSize&&this.grid.pageSize==this.grid.pageSizeList[c]?" selected":"",">",this.grid.pageSizeList[c],"</option>");b.push("</select></div>");
a=a.concat(b)}a=a.concat(['<div class="display-text">',this.getDisplayText(0,0,0),"</div>",'<div class="page-navigator"><table border="0" cellspacing="0" cellpadding="0">','<tr align="center">','<td width="18"><input type="button" class="page-first" title="',this.grid.firstText,'"/></td>','  <td width="18"><input type="button" class="page-pre" title="',this.grid.prevText,'"/></td>','  <td width="18"><input type="button" class="page-next" title="',this.grid.nextText,'"/></td>','  <td width="18"><input type="button" class="page-last" title="',
this.grid.lastText,'"/></td>','  <td width="10"  class="page-seperator">|</td>','  <td width="48">',this.grid.pageNumberText,"</td>",'\t<td width="20"><input class="page-number" type="text" value="1"/></td>','  <td width="10">/</td>','  <td width="15"><span class="total-page-size">1</span></td>',' \t<td width="50">',this.getJumperButtonHtml(),"</td>","</tr>"," </table></div>","</div>"]);this.toolbar=d(a.join(""));this.grid.container.append(this.toolbar);var e=this;this.getPageNextEl().click(function(){var f=
parseInt(e.getPageNumberEl().val());f<parseInt(e.getTotalPageSizeEl().html())&&e.grid.goPage(f+1)});this.getPagePreEl().click(function(){var f=parseInt(e.getPageNumberEl().val());f>1&&e.grid.goPage(--f)});this.getPageFirstEl().click(function(){parseInt(e.getPageNumberEl().val())>1&&e.grid.goPage(1)});this.getPageLastEl().click(function(){var f=parseInt(e.getPageNumberEl().val()),g=parseInt(e.getTotalPageSizeEl().html());f<g&&e.grid.goPage(g)});this.addJumperButtonEvent();this.getPageNumberEl().keydown(function(f){f.stopPropagation();
f.which==13&&e.handlerPageNumberEvent(d(this))}).focus(function(){d(this).select()});this.getPageSizeSelectEl().change(function(){e.grid.setPageSize(this.value);e.grid.goPage(1)});this.addPageElHoverEvent(this.getPageFirstEl(),"first");this.addPageElHoverEvent(this.getPagePreEl(),"pre");this.addPageElHoverEvent(this.getPageNextEl(),"next");this.addPageElHoverEvent(this.getPageLastEl(),"last")},getJumperButtonHtml:function(){return['<div class="grid-btn-order"><ul><li class="left-normal"></li><li class="middle-normal">',
this.grid.jumperText,'</li><li class="right-normal"></li></ul></div>'].join("")},addJumperButtonEvent:function(){var a=this;this.toolbar.find("li.middle-normal").hover(function(){d(this).prev().addClass("left-over");d(this).addClass("middle-over");d(this).next().addClass("right-over")},function(){d(this).prev().removeClass("left-over");d(this).removeClass("middle-over");d(this).next().removeClass("right-over")}).click(function(){a.handlerPageNumberEvent(a.getPageNumberEl())})},updateToolbar:function(){var a=
this.grid.pageSize,b=this.grid.data.totalCount||this.grid.data.result.length,c=this.grid.paras.start,e=c+this.grid.data.result.length,f=c/a+1;a=parseInt((b==0?b:b-1)/a)+1;b=this.grid.data.result.length>0?this.getDisplayText(c+1,e,b):this.grid.emptyMsg;this.getPageNumberEl().val(f);this.setDisplayText(b);this.getTotalPageSizeEl().html(a);if(f==1){this.getPageFirstEl().addClass("page-first-disabled");this.getPagePreEl().addClass("page-pre-disabled")}else{this.getPageFirstEl().removeClass("page-first-disabled");
this.getPagePreEl().removeClass("page-pre-disabled")}if(f==a){this.getPageNextEl().addClass("page-next-disabled");this.getPageLastEl().addClass("page-last-disabled")}else{this.getPageNextEl().removeClass("page-next-disabled");this.getPageLastEl().removeClass("page-last-disabled")}},format:function(a){var b=Array.prototype.slice.call(arguments,1);if(!a)throw"format is null";return a.replace(/\{(\d+)\}/g,function(c,e){return b[e]})},setDisplayText:function(a){this.getDisplayTextEl().html(a)},getDisplayText:function(a,
b,c){return this.format(this.grid.displayMsg,'<span class="record-start">'+a+"</span>",'<span class="record-end">'+b+"</span>",'<span class="record-amount">'+c+"</span>")},addPageElHoverEvent:function(a,b){a.hover(function(){a.hasClass("page-"+b+"-disabled")||a.addClass("page-"+b+"-over")},function(){a.removeClass("page-"+b+"-over")})},getPageNumberEl:function(){return this.pageNumberEl||(this.pageNumberEl=this.toolbar.find(":input.page-number"))},getDisplayTextEl:function(){return this.displayTextEl||
(this.displayTextEl=this.toolbar.find(".display-text"))},getTotalPageSizeEl:function(){return this.totalPageSizeEl||(this.totalPageSizeEl=this.toolbar.find(".total-page-size"))},getPageFirstEl:function(){return this.pageFirstEl||(this.pageFirstEl=this.toolbar.find(".page-first"))},getPagePreEl:function(){return this.pagePreEl||(this.pagePreEl=this.toolbar.find(".page-pre"))},getPageNextEl:function(){return this.pageNextEl||(this.pageNextEl=this.toolbar.find(".page-next"))},getPageLastEl:function(){return this.pageLastEl||
(this.pageLastEl=this.toolbar.find(".page-last"))},getPageSizeSelectEl:function(){return this.pageSizeSelectEl||(this.pageSizeSelectEl=this.toolbar.find(".page-size-list-select"))},handlerPageNumberEvent:function(a){var b=parseInt(a[0].value);if(!isNaN(b)){var c=parseInt(this.getTotalPageSizeEl().html());if(b>c){this.grid.goPage(c);a.val(c)}else if(b<=0){this.grid.goPage(1);a.val(1)}else this.grid.goPage(b)}}};d.uiwidget.ComplexPageToolbar=function(){};d.uiwidget.ComplexPageToolbar.prototype={displayMsg:"\u5171{0}\u6761\uff0c\u663e\u793a{1}-{2}\u6761",
jumperMsg:"\u8df3\u9875",prevText:"&lt;&lt;",nextText:"&gt;&gt;",pageSizeListText:"\uff0c\u663e\u793a\u6761\u6570\uff1a",renderToolbar:function(){var a=['<div class="grid-bottom-ctoolbar"><ul><li class="display-text">\u5171<span class="bold">1</span>\u6761\uff0c\u663e\u793a<span class="bold">1</span>-<span class="bold">1</span>\u6761</li>'];if(this.grid.pageSizeList){for(var b=['<li class="page-size-list">',this.pageSizeListText,'<select class="page-size-list-select">'],c=0;c<this.grid.pageSizeList.length;c++)b.push("<option value=",
this.grid.pageSizeList[c],this.grid.pageSize&&this.grid.pageSize==this.grid.pageSizeList[c]?" selected":"",">",this.grid.pageSizeList[c],"</option>");b.push("</select></li>");a=a.concat(b)}a=a.concat(['<li class="display-line">&#160;</li><li class="nav">','<li><input type="text" class="page-number" value="',this.jumperMsg,'" /></li>',"</div>"]);this.toolbar=d(a.join(""));this.grid.container.append(this.toolbar);var e=this.grid,f=this;this.getNavEl().bind("click",{toolbar:this},function(g){var h=d(g.target),
i=g.data.toolbar,j=h.html();pageNum=h.children(".first-ellipsis").length>0||h.hasClass(".first-ellipsis")?1:h.children(".last-ellipsis").length>0||h.hasClass(".last-ellipsis")?i.totalPageSize:j==i.nextText?i.pageNum+1:j==i.prevText?i.pageNum-1:Number(h.html());e.triggerHandler("toolbarPagenumClick",[e,h,pageNum],g)});this.getPageNumberEl().focus(function(){d(this).val()==f.jumperMsg&&d(this).val("")}).blur(function(){d(this).val()==""&&d(this).val(f.jumperMsg)}).keydown(function(g){g.stopPropagation();
g.which==13&&f.handlerPageNumberEvent(d(this))});this.getPageSizeSelectEl().change(function(){f.grid.setPageSize(this.value);f.grid.goPage(1)});e.bind("toolbarPagenumClick",function(g,h,i,j){h.goPage(j)})},updateToolbar:function(){var a=this.grid.pageSize,b=this.grid.data.totalCount||this.grid.data.result.length,c=this.grid.paras.start,e=c+this.grid.data.result.length;this.pageNum=c/a+1;this.totalPageSize=parseInt((b==0?b:b-1)/a)+1;this.setDisplayText(this.grid.data.result.length>0?this.getDisplayText(c+
1,e,b):this.grid.emptyMsg);this.updatePageNav()},updatePageNav:function(){var a=[];if(this.totalPageSize==1){this.getPageNumberEl().hide();this.getDisplayLineEl().hide();this.getNavEl().empty()}else{if(this.totalPageSize<=5){if(this.pageNum!=1)a=this.renderPrevPage(a);for(var b=0;b<this.totalPageSize;b++)a=this.pageNum==b+1?this.renderCurrent(b+1,a):this.renderPage(b+1,a);if(this.pageNum!=this.totalPageSize)a=this.renderNextPage(a)}else{if(this.pageNum==1){from=1;to=5}else if(this.totalPageSize-this.pageNum>
3){from=this.pageNum-1;to=this.pageNum+3}else{to=this.totalPageSize;from=to-4}if(from!=1)a=this.renderFirstPage(a);if(this.pageNum!=1)a=this.renderPrevPage(a);for(b=from;b<to+1;b++)a=this.pageNum==b?this.renderCurrent(this.pageNum,a):this.renderPage(b,a);if(this.pageNum!=this.totalPageSize)a=this.renderNextPage(a);if(to!=this.totalPageSize)a=this.renderLastPage(this.totalPageSize,a)}this.getPageNumberEl().show();this.getDisplayLineEl().show();this.getNavEl().empty().append(a.join(""))}},renderCurrent:function(a,
b){return b=b.concat(['<span class="current">',a,"</span>"])},renderPage:function(a,b){return b=b.concat(['<a href="javascript:void(0)" class="page" hidefocus="true">',a,"</a>"])},renderPrevPage:function(a){return this.renderPage(this.prevText,a)},renderNextPage:function(a){return this.renderPage(this.nextText,a)},renderFirstPage:function(a){return a=a.concat(['<a href="javascript:void(0)" class="page" hidefocus="true">',1,'<span class="ellipsis first-ellipsis">...</span></a>'])},renderLastPage:function(a,
b){return b=b.concat(['<a href="javascript:void(0)" class="page" hidefocus="true"><span class="ellipsis last-ellipsis">...</span>',a,"</a>"])},format:function(a){var b=Array.prototype.slice.call(arguments,1);if(!a)throw"format is null";return a.replace(/\{(\d+)\}/g,function(c,e){return b[e]})},setDisplayText:function(a){this.getDisplayTextEl().html(a)},getDisplayText:function(a,b,c){return this.format(this.displayMsg,'<span class="bold">'+c+"</span>",'<span class="bold">'+a+"</span>",'<span class="bold">'+
b+"</span>")},handlerPageNumberEvent:function(a){var b=parseInt(a[0].value);if(!isNaN(b))if(b>this.totalPageSize){this.grid.goPage(this.totalPageSize);a.val(this.totalPageSize)}else if(b<=0){this.grid.goPage(1);a.val(1)}else this.grid.goPage(b)},getPageNumberEl:function(){return this.pageNumberEl||(this.pageNumberEl=this.toolbar.find(":input.page-number"))},getDisplayTextEl:function(){return this.displayTextEl||(this.displayTextEl=this.toolbar.find(".display-text"))},getNavEl:function(){return this.navEl||
(this.navEl=this.toolbar.find(".nav"))},getPageSizeSelectEl:function(){return this.pageSizeSelectEl||(this.pageSizeSelectEl=this.toolbar.find(".page-size-list-select"))},getDisplayLineEl:function(){return this.displayLineEl||(this.displayLineEl=this.toolbar.find(".display-line"))}};d.uiwidget.Calculations={defPrecision:2,sum:function(a,b,c,e){b=Number(e[b]);if(!isNaN(b))return b+(a||0)},max:function(a,b,c,e){b=Number(e[b]);if(!isNaN(b))return(a||0)<b?b:a||0},min:function(a,b,c,e){b=Number(e[b]);if(!isNaN(b))return(a||
b)<b?a||b:b},count:function(a){return(a||0)+1},average:function(a,b,c,e){b=Number(e[b]);if(!isNaN(b))return((a||0)*c+b)/(c+1)}};d.extend({accAdd:function(a,b){try{a.toString().split(".")}catch(c){}try{b.toString().split(".")}catch(e){}return(parseInt(a*void 0)+parseInt(b*void 0))/void 0},accMin:function(a,b){var c,e;try{c=a.toString().split(".")[1].length}catch(f){c=0}try{e=b.toString().split(".")[1].length}catch(g){e=0}c=Math.pow(10,Math.max(c,e));return(parseInt(a*c)-parseInt(b*c))/c},accMul:function(a,
b){var c=0;a=a.toString();b=b.toString();try{c+=a.split(".")[1].length}catch(e){}try{c+=b.split(".")[1].length}catch(f){}return Number(a.replace(".",""))*Number(b.replace(".",""))/Math.pow(10,c)},accDiv:function(a,b){var c=0,e=0;try{c=a.toString().split(".")[1].length}catch(f){}try{e=b.toString().split(".")[1].length}catch(g){}a=Number(a.toString().replace(".",""));b=Number(b.toString().replace(".",""));return d.accMul(a/b,Math.pow(10,e-c))}});d.uiwidget.RowNumberer={header:"",sortable:false,dataIndex:"gridRowNumberer",
width:"25px",renderer:function(a,b,c){return c+1}};d.uiwidget.PageRowNumberer={header:"",sortable:false,dataIndex:"gridPageRowNumberer",width:"25px",renderer:function(a,b,c,e,f,g){return(g.getPageNumber()-1)*g.getPageSize()+c+1}};d.fn.grid=function(a){return new d.uiwidget.Grid(this,a)};d.createDelegate=function(a,b,c,e){return function(){var f=c||arguments;if(e===true){f=Array.prototype.slice.call(arguments,0);f=f.concat(c)}else if(typeof e=="number"){f=Array.prototype.slice.call(arguments,0);var g=
[e,0].concat(c);Array.prototype.splice.apply(f,g)}return a.apply(b||window,f)}};d.defer=function(a,b,c,e,f){a=d.createDelegate(a,c,e,f);if(b)return setTimeout(a,b);a();return 0};d.uiwidget.GridRowBuilder=d.uiwidget.Class.create({rowIncrement:0,cellIncrement:0,buildRow:function(a,b){var c=[];c.push('<div class="grid-row" id="grid-row-',this.rowIncrement++,'"><table class="grid-bd-table" cellspacing="0" cellpadding="0" ','><tbody><tr class="grid-bd-row">');for(var e=0;e<this.grid.cm.length;e++){var f=
this.grid.cm[e];if(f.checkbox)c.push('<td class="grid-bd-chk" style="width:',f.width?f.width:this.grid.checkboxWidth+"px",'"><div class="grid-inner">',b?'<input type="checkbox" class="grid-body-checkbox" value=""/>':"","</div></td>");else{var g=b[f.dataIndex];if(typeof g=="number"&&f.precision)g=b[f.dataIndex].toFixed(f.precision);var h={};h.css=["grid-cm-",f.dataIndex," grid-cell-",f.dataIndex].join("");if(f.renderer)g=f.renderer(g,b,a,e,h,this.grid);c.push('<td hidefocus="true" style="width:',f.width,
'" id="grid-td-',this.cellIncrement++,'" class="grid-row-td ',h.css,'" title="',h.title,'" tabindex="-1"><div class="grid-inner"');if(f.width)if(typeof f.width=="string"){h=f.width.indexOf("px");f=Number(f.width.substring(0,h))-8;c.push(' style="width:',f,'px;"')}else c.push(' style="width:',f.width,'"');if(/<.*>/.exec(g))c.push(">");else{f=null;f=!b||g==null||g==undefined||typeof g=="string"&&g.length<1?"":typeof g=="string"?g.replace(/\"/g,"&quot;"):g;c.push(' title="',f,'">')}c.push(g);c.push("</div></td>")}}c.push("</tr></tbody></table></div>");
return c}});d.uiwidget.Collection=function(a){d.extend(this,a);this.items=[];this.map={};this.keys=[];this.length=0;if(!Array.prototype.indexOf)Array.prototype.indexOf=function(b,c){var e=this.length>>>0;c=~~c;if(c<0)c+=e;for(;c<e;c++)if(c in this&&this[c]===b)return c;return-1}};d.uiwidget.Collection.prototype={add:function(a,b){if(arguments.length==1){b=arguments[0];a=this.getKey(b)}if(typeof a!="undefined"&&a!==null){if(typeof this.map[a]!="undefined")return this.replace(a,b);this.map[a]=b}this.length++;
this.items.push(b);this.keys.push(a);return b},remove:function(a){return this.removeAt(this.indexOf(a))},removeAt:function(a){if(a<this.length&&a>=0){this.length--;var b=this.items[a];this.items.splice(a,1);var c=this.keys[a];typeof c!="undefined"&&delete this.map[c];this.keys.splice(a,1);return b}return false},getKey:function(a){return a.id},replace:function(a,b){if(arguments.length==1){b=arguments[0];a=this.getKey(b)}var c=this.map[a];if(typeof a=="undefined"||a===null||typeof c=="undefined")return this.add(a,
b);this.items[this.indexOfKey(a)]=b;return this.map[a]=b},indexOfKey:function(a){return this.keys.indexOf(a)},indexOf:function(a){return this.items.indexOf(a)},getCount:function(){return this.length},clear:function(){this.length=0;this.items=[];this.keys=[];this.map={}},each:function(a,b){for(var c=[].concat(this.items),e=0,f=c.length;e<f;e++)if(a.call(b||c[e],c[e],e,f)===false)break}}})(jQuery);
