/**
* Grid×é¼þ
*
* @author Vincent (zhongyongsheng@ceopen.cn)
* @date 2011-03-28
* @version 2.0.3
*/
(function(f){f.uiwidget=f.uiwidget||{};f.uiwidget.Class=f.uiwidget.Class||{create:function(a){function b(){this.initialize.apply(this,arguments)}f.extend(b.prototype,a);if(!b.prototype.initialize)b.prototype.initialize=function(){};return b.prototype.constructor=b}};f.uiwidget.isIE=!!window.ActiveXObject;f.uiwidget.isIE6=f.uiwidget.isIE&&!window.XMLHttpRequest;f.uiwidget.isIE8=f.uiwidget.isIE&&!!document.documentMode;f.uiwidget.isIE7=f.uiwidget.isIE&&!f.uiwidget.isIE6&&!f.uiwidget.isIE8;f.uiwidget.Grid=
function(a,b){f.extend(this,b);this.grid=a;this.init();this.render()};f.uiwidget.Grid.prototype={pageNumberText:"\u9875\u7801\uff1a",jumperText:"\u8df3\u5230",firstText:"\u9996\u9875",prevText:"\u524d\u4e00\u9875",nextText:"\u4e0b\u4e00\u9875",lastText:"\u672b\u9875",emptyMsg:"\u6ca1\u6709\u8bb0\u5f55",displayMsg:"\u663e\u793a {0} - {1}\u6761\uff0c\u5171 {2} \u6761",pageSizeListText:"\u663e\u793a\u6761\u6570\uff1a",height:375,cm:[],data:{totalCount:0,result:[]},displayHeader:true,autoLoad:true,defaultLineHeight:25,
scrollOffsetWidth:17,cache:false,cellBorder:1,init:function(){this.initParas();var a=this;f.each(["","Single","Multi"],function(b,c){a["getContextMenu"+c]=function(){if(!a["cMenu"+c])if(a.grid.menu)a["cMenu"+c]=a.grid.menu(a["contextMenu"+c]);return a["cMenu"+c]}});f.each(["beforeRender","afterRender","beforeRowClick","headerCheckboxClick"],function(b,c){a[c]&&a.bind(c,a[c])});this.sm=this.sm||new f.uiwidget.RowSelectionModel;this.sm.grid=this;this.cacheData=this.data;this.pageToolbar=this.pageToolbar||
new f.uiwidget.ComplexPageToolbar;this.pageToolbar.grid=this;this.rowBuilder=this.rowBuilder||new f.uiwidget.GridRowBuilder;this.rowBuilder.grid=this},initParas:function(){this.paras={};if(this.defaultSort){this.paras.sort=this.defaultSort.field;this.paras.dir=this.defaultSort.direction}if(this.pageSize){this.paras.start=0;this.paras.limit=this.pageSize}f.extend(this.paras,this.baseParams)},render:function(){var a=this;this.container=f(['<div class="grid-container"><div class="grid-main-wrap"><div class="grid-mainhead-wrap"><table class="grid-main" cellspacing="0" cellpadding="0"><thead></thead></table></div><div class="grid-mainbody-wrap"  style="height:',
this.height,'px;"><div class="grid-mainbody"></div></div></div></div>'].join(""));this.grid.append(this.container);this.mainWrap=a.container.children(".grid-main-wrap");this.mainHeadWrap=a.mainWrap.children(".grid-mainhead-wrap");this.mainBodyWrap=a.mainWrap.children(".grid-mainbody-wrap");this.mainBody=this.mainBodyWrap.find(".grid-mainbody");if(this.displayHeader)this.customHeader?this.renderCustomHeader():this.renderHeader();this.headerTd=this.mainHeadWrap.find("thead").find("td");this.headerCb=
this.mainHeadWrap.find(".grid-header-checkbox");this.displayHeader&&this.addHeaderEvent();this.renderEditor();this.pageSize&&this.pageToolbar.renderToolbar();if(this.showSummaryBar)if(f.uiwidget.SummaryBar)this.summaryBar=new f.uiwidget.SummaryBar(this);if(this.viewConfig&&this.viewConfig.horizontalScroll){this.mainBodyWrap.css("overflow-x","auto");this.mainBodyWrap.css("position","relative");this.addHorizontalScroller(this.mainHeadWrap);this.mainBody.addClass("grid-mainbody-scroller");this.mainBodyWrap.bind("scroll",
function(){var b=f(this),c=b.scrollLeft();b=b.scrollTop();a.mainHeadWrap.scrollLeft(c);a.triggerHandler("bodyscroll",[a,c,b])})}this.autoLoad&&this.loadData();this.trigger("rendered",[this])},addHorizontalScroller:function(a){a.wrapInner('<div class="grid-mainhead-scroller"></div>')},buildHeadRow:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d.checkbox)b.push("<th ",d.row?" rowspan="+d.row:"",d.col?" colspan="+d.col:"",d.hidden?' style="display:none"':"",d.dataIndex,' unselectable="on"><input type="checkbox" class="grid-header-checkbox"></th>');
else{b.push("<td ",d.row?" rowspan="+d.row:"",d.col?" colspan="+d.col:"",d.hidden?' style="display:none"':"",' style="width:',d.width,'"  class="grid-cm-',d.dataIndex," grid-header-",d.dataIndex,'">');c==0?b.push('<span class="grid-title-blank" '):b.push('<span class="grid-title-line" ');d.title==undefined?b.push('title="',d.header,'"'):b.push('title="',d.title,'"');b.push('unselectable="on"><a class="grid-title-text">',d.header);d.iconCls&&b.push('<input type="button" hideFocus="true" class="',d.iconCls,
'"/>');d.sortable!==false?b.push('</a><div class="sort-icon"/>'):b.push("</a>");b.push("</div></td>")}}return b},renderCustomHeader:function(){var a=[],b=this;a=['<tr class="grid-header-row-hidden">'];a=a.concat(this.buildHeadRow(this.cm));a.push("</tr>");f.each(this.customHeader,function(c,d){a.push("<tr>");a=a.concat(b.buildHeadRow(d));a.push("</tr>")});this.mainHeadWrap.find("thead").append(a.join(""))},renderHeader:function(){var a=["<tr>"];a=a.concat(this.buildHeadRow(this.cm));a.push("</tr>");
this.mainHeadWrap.find("thead").append(a.join(""))},renderEditor:function(){var a=this;a.focus=f('<a class="grid-focus" tabindex="-1" href="#"/>');a.mainBodyWrap.append(a.focus);f.each(this.cm,function(b,c){if(c.editor){if(typeof c.editor=="string")c.editor={html:c.editor};if(typeof c.editor=="object"){b=c.editor;if(b.type)if(b.type=="text"){var d="grid-editor-"+c.dataIndex;b.html=['<input id="',d,'" class="',d," ",b.cls,'" type="text" />'].join("")}else if(b.type=="date"){d="grid-editor-"+c.dataIndex;
b.html=f(['<input id="',d,'" class="',d," ",b.cls,'" type="text" />'].join(""));a.grid.append(b.html);Calendar.setup({inputField:b.html[0],ifFormat:"%Y-%m-%d",button:b.html[0]});b.startEdit=function(e,g){g.getEditEl()[0].onclick()}}c.editor=a.mainBodyWrap.editor({field:b.html});c.editor.bind("onComplete",function(e,g){e=g.bindEl;a.doFocus(e);var h=a.findRowIndex(a.findParentRow(e)),i=a.getDataIndex(e.parents("td")[0]);a.data.result[h][i]=g.getValue();a.addTitle(e,g.getValue());if(a.sm.activateEditor)a.sm.activateEditor=
null});c.editor.bind("onCancel",function(e,g){a.doFocus(g.bindEl)});b.startEdit&&c.editor.bind("startEdit",b.startEdit);b.beforeComplete&&c.editor.bind("beforeComplete",b.beforeComplete);b.onComplete&&c.editor.bind("onComplete",b.onComplete);b.onCancel&&c.editor.bind("onCancel",b.onCancel)}}})},doFocus:function(){f.browser.mozilla?f.defer(function(){this.focus.focus()},1,this):this.focus.focus()},addTitle:function(a,b){a.attr("title",b)},addHeaderEvent:function(){var a=this;this.headerTd.filter(":has(.sort-icon)").mouseover(function(){f(this).addClass("grid-header-sort-on")}).mouseout(function(){f(this).removeClass("grid-header-sort-on")}).click(function(){var b=
f(this);if(b.hasClass("sort-asc")){a.paras.dir="DESC";b.removeClass("sort-asc").addClass("sort-desc")}else{a.paras.dir="ASC";b.removeClass("sort-desc").addClass("sort-asc")}a.headerTd.not(this).removeClass("sort-asc sort-desc");a.paras.sort=a.getDataIndex(this);a.loadData()})},getDataIndex:function(a){return a.className.split(" ")[0].split("-")[2]},loadData:function(a){var b=this;if(this.url)f.ajax({dataType:"json",type:"POST",url:this.url,data:this.paras,cache:this.cache,timeout:this.timeout||6E4,
contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(c){b.data=c;a&&a.call(b);b.renderData()}});else{b.setDataFromCacheByPageNumber();a&&a.call(b);b.renderData()}},setDataFromCacheByPageNumber:function(){if(this.pageSize){var a=(this.getPageNumber()-1)*this.pageSize;this.setData({totalCount:this.cacheData.totalCount,result:this.cacheData.result.slice(a,a+this.pageSize)})}},reloadInsertBefore:function(a,b){this.loadInit(function(){this.insertDataBefore(a,b)})},insertRecordsBefore:function(a,
b){this.insertDataBefore(a,b);this.renderData()},insertDataBefore:function(a,b){if(typeof a==="string")a=eval("("+a+")");if(a.totalCount)a=a.result;else if(!a.length){var c=[];c.push(a);a=c}this.filterData(a,b);for(b=0;b<a.length;b++)this.data.result.unshift(a[b]);if(this.pageSize)if(this.data.result.length>this.pageSize)this.data.result=this.data.result.slice(0,this.pageSize)},filterData:function(a,b){b||(b=function(h,i){if(h.id==i.id)return true});for(var c=[],d=0;d<a.length;d++)for(var e=0,g=this.data.result.length;e<
g;e++)b.call(this,this.data.result[e],a[d])&&c.push(this.data.result[e]);for(d=0;d<c.length;d++)this.data.result.splice(jQuery.inArray(c[d],this.data.result),1)},modifySelectedRecords:function(a){for(var b=this.getSelectedRow(),c=0,d=a.length;c<d;c++){var e=b.eq(c),g=e.find("th,td");e=this.findRowIndex(e);for(var h=0,i=this.cm.length;h<i;h++)if(!this.cm[h].checkbox){this.data.result[e]=a[c];var j=a[c][this.cm[h].dataIndex],k={};k.css="grid-cm-"+this.cm[h].dataIndex;if(this.cm[h].renderer)j=this.cm[h].renderer(j,
a[c],e,h,k);if(!a[c]||j==null||j==undefined||typeof j=="string"&&j.length<1)j="";k=g.eq(h).children(".grid-body-inner-span");k.html(j);this.addTitle(k,j)}}},renderData:function(){this.triggerHandler("beforeRender",[this]);this.headerCb.attr("checked",false);if(this.data&&this.data.result){for(var a=[],b=0;b<this.data.result.length;b++)a=a.concat(this.rowBuilder.buildRow(b,this.data.result[b]));this.mainBody.empty().append(a.join(""));this.sm.initEvent();if(this.data.result.length<1){this.showEmptyText();
f.uiwidget.isIE&&this.mainBody.hide()}else{this.hideEmptyText();f.uiwidget.isIE&&this.mainBody.show()}}this.pageSize&&this.pageToolbar.updateToolbar();this.sync();this.triggerHandler("afterRender",[this])},sync:function(){if(f.uiwidget.isIE){this.mainBodyWrap.width(this.grid.width());this.mainHeadWrap.width(this.grid.width())}if(this.viewConfig&&this.viewConfig.horizontalScroll){var a=this.mainBody.find(".grid-main"),b=this.mainHeadWrap.find(".grid-main"),c=this.mainHeadWrap.find(".grid-mainhead-scroller");
a.width(this.getTotalColumnWidth());this.mainBody.width(this.getTotalColumnWidth());b.width(this.getTotalColumnWidth());f.uiwidget.isIE6||c.width(this.getTotalColumnWidth()+this.scrollOffsetWidth)}else if(this.isOverHeight()){f.defer(function(){this.mainHeadWrap.find(".grid-main").width(this.mainHeadWrap.width()-this.scrollOffsetWidth);this.mainBody.width(this.mainBodyWrap.width()-this.scrollOffsetWidth)},1,this);this.mainHeadWrap.addClass("grid-mainhead-wrap-scrollOffset")}else if(this.mainHeadWrap.hasClass("grid-mainhead-wrap-scrollOffset")){this.mainHeadWrap.find(".grid-main").width(this.mainBodyWrap.width());
this.mainBody.width(this.mainBodyWrap.width());this.mainHeadWrap.removeClass("grid-mainhead-wrap-scrollOffset")}},isOverHeight:function(){return this.mainBody.height()>this.mainBodyWrap.height()},isOverWidth:function(){return this.mainBody.find(".grid-main").width()>this.mainBodyWrap.width()},getTotalColumnWidth:function(){if(!this.totalColumnWidth)for(var a=this.totalColumnWidth=0,b=this.cm.length;a<b;a++)this.cm[a].hidden||(this.totalColumnWidth+=this.getColumnWidth(a));return this.totalColumnWidth},
getColumnWidth:function(a){var b=this.cm[a].width;if(b){if(typeof b=="string"){a=b.indexOf("px");b=Number(b.substring(0,a))}}else b=this.cm[a].checkbox?29:0;return b},showEmptyText:function(){this.mainBody.after(this.emptyText||(this.emptyText=f('<div class="grid-empty-text">'+this.emptyMsg+"</div>")));this.emptyText.show()},hideEmptyText:function(){this.emptyText&&this.emptyText.hide()},updateHeaderCheckbox:function(){this.getSelections().length==this.data.result.length?this.headerCb.attr("checked",
true):this.headerCb.attr("checked",false)},goPage:function(a){if(a){this.pageNumber=a;this.paras.start=(a-1)*this.pageSize}else this.pageNumber=0;this.loadData()},getPageNumber:function(){return this.pageNumber||(this.pageNumber=1)},getPageSize:function(){return this.pageSize},getSelections:function(){return this.sm.getSelections()},getSelectedRowIndex:function(){return this.sm.getSelectedRowIndex()},hasSelected:function(){return this.sm.hasSelected()},getData:function(){return this.data},setData:function(a){this.data=
a},getResult:function(){return this.getData().result},reload:function(){this.loadData()},load:function(){this.loadData()},loadInit:function(a){this.initParas();this.loadData(a);this.headerTd.removeClass("sort-asc sort-desc")},addContextMenuItem:function(a){return this.getContextMenu().addMenuItem(a)},query:function(a){f.extend(this.paras,{start:0,limit:this.pageSize});f.extend(this.paras,a);this.loadData()},search:this.query,setPageSize:function(a){this.pageSize=this.paras.limit=a},getSelectedRow:function(){return this.sm.getSelectedRow()},
getSelectionModel:function(){return this.sm},moveTop:function(a){var b=this.findRowIndex(a);if(b!=0){var c=this.getFirstRow();this.data.result.splice(0,0,this.data.result.splice(b,1)[0]);c.before(a)}},moveUp:function(a){var b=this.findRowIndex(a);if(b!=0){var c=this.findPrevRow(a),d=b-1;b=this.data.result.splice(b,1)[0];this.data.result.splice(d,0,b);c.before(a)}},moveDown:function(a){var b=this.findRowIndex(a);if(b!=this.data.result.length-1){var c=this.findNextRow(a),d=b+1;b=this.data.result.splice(b,
1)[0];this.data.result.splice(d,0,b);c.after(a)}},moveBottom:function(a){var b=this.findRowIndex(a);if(b!=this.data.result.length-1){var c=this.getLastRow(),d=this.data.result.length-1;b=this.data.result.splice(b,1)[0];this.data.result.splice(d,0,b);c.after(a)}},appendRow:function(a){this.hideEmptyText();if(a.length)for(var b=0;b<a.length;b++){var c=f(this.rowBuilder.buildRow(this.data.result.length+b,a[b]).join(""));this.mainBody.append(c);this.sm.addRowEvent(c)}else{c=f(this.rowBuilder.buildRow(this.data.result.length+
b,a[b]).join(""));this.mainBody.append(c);this.sm.addRowEvent(c)}this.data.result=f.merge(this.data.result,a);this.sync()},replaceRow:function(a,b){var c=this.getRow(a);c.find("th,td");this.data.result[a]=f.extend(this.data.result[a],b);a=f(this.rowBuilder.buildRow(a,this.data.result[a]).join("")).children();c.empty();c.append(a)},removeRow:function(a){var b=this;a.each(function(){var c=f(this);b.data.result.splice(b.findRowIndex(c),1);c.remove()});if(this.data.result.length<1){this.headerCb.attr("checked",
false);this.showEmptyText()}this.sync()},findRowIndex:function(a){return this.mainBody.children(".grid-row").index(a.nodeType?a:a[0])},findCellIndex:function(a){return f(a).parent("tr").find("th,td").index(a.nodeType?a:a[0])},getAllRow:function(){return this.mainBody.children(".grid-row")},getRow:function(a){return this.mainBody.children(".grid-row:eq("+a+")")},getCell:function(a,b){return this.getRow(a).find("th,td").eq(b)},findParentRow:function(a){return a.parents(".grid-row")},findParentCell:function(a){return a.is("[class*=grid-row-td]")?
a:a.parents("[class*=grid-row-td]")},getFirstRow:function(){return this.mainBody.find(".grid-row:first")},getLastRow:function(){return this.mainBody.find(".grid-row:last")},findPrevRow:function(a){return a.prev(".grid-row")},findNextRow:function(a){return a.next(".grid-row")},bind:function(a,b,c){a=a.toLowerCase();return typeof b=="object"?this.grid.bind(a,b,c):this.grid.bind(a,b)},trigger:function(a,b){return this.grid.trigger(a,b)},triggerHandler:function(a,b,c){a=a.toLowerCase();if(c){if(this.grid[0]){c.type=
a;c.triggerTarget=c.target;c.stopPropagation();f.event.trigger(c,b,this.grid[0],false);return c.result}}else return this.grid.triggerHandler(a,b)},getHeight:function(){return this.height},setHeight:function(a){this.mainBodyWrap.height(this.height=a)},getLineHeight:function(){return this.lineHeight||(this.lineHeight=this.mainBody.children("tr").height())||this.defaultLineHeight},scrollTo:function(a){this.mainBodyWrap.scrollTop(a)},getScrollPos:function(){return this.mainBodyWrap.scrollTop()},getScrollArea:function(){return this.mainBodyWrap.height()},
scrollToRow:function(a){var b=this.getRow(a);a=this.getScrollPos();var c=this.getScrollArea(),d=b.position().top-this.mainHeadWrap.height()+a;b=d+b.height();if(d<a)this.scrollTo(d);else b>a+c&&this.scrollTo(b-c)}};f.uiwidget.RowSelectionModel=function(a){f.extend(this,a)};f.uiwidget.RowSelectionModel.prototype={initEvent:function(){var a=this.grid,b=this;a.getAllRow().each(function(){b.addRowEvent(f(this))});if(!this.isBinding){this.isBinding=true;a.onRowClick&&a.bind("rowClick",a.onRowClick);a.onRowDblclick&&
a.bind("rowDblclick",a.onRowDblclick);a.rowContextMenu&&a.bind("rowContextMenu",a.rowContextMenu);a.headerCb.click(function(){f(this).attr("checked")?b.select(a.getAllRow()):b.deselect(a.getAllRow());a.triggerHandler("headerCheckboxClick",[a])})}},addRowEvent:function(a){var b=this,c=this.grid;a.click(function(d){d.stopPropagation();if(c.triggerHandler("beforeRowClick",[c,a],d)!==false){if(d.ctrlKey&&c.cm[0].checkbox)b.toggle(a);else if(d.shiftKey&&c.cm[0].checkbox){d=c.findRowIndex(a);var e=c.lastSelection?
c.findRowIndex(c.lastSelection):d;b.selectRange(d,e)}else b.handlerClickRow(a);c.updateHeaderCheckbox();c.triggerHandler("rowClick",[c,a])}});a.find(":checkbox.grid-body-checkbox").each(function(){b.addRowCheckboxEvent(c,f(this))});a.mouseover(function(){a.addClass("grid-row-over");c.triggerHandler("rowMouseOver",[c,a])});a.mouseout(function(){a.removeClass("grid-row-over");c.triggerHandler("rowMouseOut",[c,a])});a.dblclick(function(){c.triggerHandler("rowDblclick",[c,a])});a.bind("contextmenu",function(d){d.preventDefault();
c.triggerHandler("rowContextMenu",[c,a],d);var e=c.getContextMenu(),g=c.getContextMenuSingle(),h=c.getContextMenuMulti();if(b.getSelections().length<2||!a.hasClass("grid-row-selected"))b.handlerClickRow(a);if(b.getSelections().length==1)if(g&&g.size()>0){b.applyContextRow(g,a);g.showAt(d.pageX,d.pageY)}else{if(e&&e.size()>0){b.applyContextRow(e,a);e.showAt(d.pageX,d.pageY)}}else if(b.getSelections().length>1)if(h&&h.size()>0){b.applyContextRow(h,a);h.showAt(d.pageX,d.pageY)}else if(e&&e.size()>0){b.applyContextRow(e,
a);e.showAt(d.pageX,d.pageY)}})},applyContextRow:function(a,b){a.contextRowEl=b;a.contextSelection=this.grid.getResult()[this.grid.findRowIndex(b)]},addRowCheckboxEvent:function(a,b){b.click(function(c){c.stopPropagation();var d=a.findParentRow(b);if(a.triggerHandler("beforeRowClick",[a,d],c)!==false){d.toggleClass("grid-row-selected");a.getSelections().length==a.data.result.length?a.headerCb.attr("checked",true):a.headerCb.attr("checked",false);a.triggerHandler("rowClick",[a,d])}})},select:function(a){a.addClass("grid-row-selected").find(":checkbox.grid-body-checkbox").attr("checked",
true);this.grid.lastSelection=a},deselect:function(a){a.removeClass("grid-row-selected").find(":checkbox.grid-body-checkbox").attr("checked",false)},selectAll:function(){this.grid.headerCb.attr("checked",true);this.select(this.grid.getAllRow())},handlerClickRow:function(a){this.deselect(this.getSelectedRow());this.select(a)},selectRange:function(a,b){var c=this.grid.getAllRow();a-b>0?this.select(c.slice(b,a+1)):this.select(c.slice(a,b+1))},toggle:function(a){a=a.toggleClass("grid-row-selected").find(":checkbox.grid-body-checkbox");
a.attr("checked")?a.attr("checked",false):a.attr("checked",true)},getSelections:function(){var a=this.grid,b=[];this.grid.mainBody.children(".grid-row-selected").each(function(c,d){b.push(a.data.result[a.findRowIndex(d)])});return b},getSelectedRowIndex:function(){var a=this.grid.mainBody.children(".grid-row-selected");return a.length>0?this.grid.findRowIndex(a):null},hasSelected:function(){return this.grid.mainBody.children(".grid-row-selected").length>0},getSelectedRow:function(){return this.grid.mainBody.children(".grid-row-selected")}};
f.uiwidget.CellSelectionModel=function(a){f.extend(this,a)};f.uiwidget.CellSelectionModel.prototype={initEvent:function(){var a=this.grid,b=this;a.mainBody.find("td").each(function(){b.addCellEvent(a,f(this))});if(!this.isBinding){this.isBinding=true;a.onCellDblclick&&a.bind("cellDblclick",a.onCellDblclick);a.onCellClick&&a.bind("cellClick",a.onCellClick);a.mainBodyWrap.keydown(function(e){b.handlerKeyDown(e)})}for(var c=a.cm,d=0;d<c.length;d++)c[d].editor&&a.mainBody.find(".grid-cell-"+c[d].dataIndex+
" .grid-body-inner-span").bind("click",{index:d},function(e){var g=f(this).attr("title");c[e.data.index].editor.startEdit(this,g)})},addRowEvent:function(a){var b=this.grid,c=this;a.find("td").each(function(){c.addCellEvent(b,f(this))})},addCellEvent:function(a,b){var c=this,d=this.grid;b.click(function(e){e.stopPropagation();if(d.triggerHandler("beforeCellClick",[d,b])!==false){e.metaKey?c.toggle(b):c.handlerClickCell(b);d.triggerHandler("cellClick",[d,b])}});b.dblclick(function(){d.triggerHandler("cellDblclick",
[d,b])});b.bind("contextmenu",function(e){e.preventDefault();var g=a.getContextMenu(),h=a.getContextMenuSingle(),i=a.getContextMenuMulti();if(c.getSelections().length<2||!b.hasClass("grid-cell-selected"))c.handlerClickCell(b);if(c.getSelections().length==1)if(h&&h.size()>0){c.applyContextCell(h,b);h.showAt(e.pageX,e.pageY)}else{if(g&&g.size()>0){c.applyContextCell(g,b);g.showAt(e.pageX,e.pageY)}}else if(c.getSelections().length>1)if(i&&i.size()>0){c.applyContextCell(i,b);i.showAt(e.pageX,e.pageY)}else if(g&&
g.size()>0){c.applyContextCell(g,b);g.showAt(e.pageX,e.pageY)}})},applyContextCell:function(a,b){a.contextCellEl=b;var c=this.grid.findCellIndex(b);b=this.grid.findRowIndex(this.grid.findParentRow(b));var d=this.grid.getResult()[b];a.contextSelection={result:d,rowIndex:b,colIndex:c,value:d[this.grid.cm[c].dataIndex]}},select:function(a){this.grid.triggerHandler("beforeCellSelect",[this.grid,a])!==false&&a.addClass("grid-cell-selected")},deselect:function(a){a.removeClass("grid-cell-selected")},handlerClickCell:function(a){this.deselect(this.grid.mainBody.find("td"));
this.select(a)},toggle:function(a){a.toggleClass("grid-cell-selected")},getSelections:function(){var a=this.grid,b=this.grid.data,c=this.grid.cm,d=[],e,g,h;this.grid.mainBody.find(".grid-cell-selected").each(function(i,j){i=f(j);e=a.findCellIndex(i);rowIndex=a.findRowIndex(a.findParentRow(i));h=b.result[rowIndex];g={result:h,rowIndex:rowIndex,colIndex:e,value:h[c[e].dataIndex]};d.push(g)});return d},getCellSelections:function(){return this.getSelections()},hasSelected:function(){return this.grid.mainBody.find(".grid-cell-selected").length>
0},getSelectedRow:function(){return this.grid.findParentRow(this.getSelectedCell())},getSelectedCell:function(){return this.grid.mainBody.find(".grid-cell-selected")},handlerKeyDown:function(a){a.stopPropagation();a.preventDefault();a=a.which;var b=this.getCellSelections()[0];if(b){var c=b.rowIndex;b=b.colIndex;if(a==13)this.startEditing&&this.startEditing(c,b);else{b=this.grid.cm[0].checkbox?b-1:b;if(a==9)this.goCells(c,b+1,1);else if(a==37)this.goCells(c,b-1,1);else if(a==39)this.goCells(c,b+1,
1);else if(a==38)this.goCells(c-1,b,1);else a==40&&this.goCells(c+1,b,1)}}},goCells:function(a,b){a==-1?(a=0):(a=a);b==-1?(b=0):(b=b);var c=this.grid.getRow(a);if(c.length<1){a--;c=this.grid.getRow(a)}b=c.find("td").eq(b);if(b.length<1){b=this.grid.findNextRow(c);if(b.length>0)c=b;b=c.find("td").eq(0)}this.handlerClickCell(b);this.grid.scrollToRow(a)},getSelectedRowIndex:function(){var a=this.grid.mainBody.find(".grid-cell-selected");return a.length>0?this.grid.findRowIndex(this.grid.findParentRow(a)):
null}};f.uiwidget.EditCellSelectionModel=function(a){f.extend(this,a)};f.extend(f.uiwidget.EditCellSelectionModel.prototype,{initEvent:function(){if(!this.isBinding){this.isBinding=true;var a=this.grid,b=this;a.mainBodyWrap.keydown(function(c){b.handlerKeyDown(c)});a.headerCb.click(function(){f(this).attr("checked")?b.selectRow(a.getAllRow()):b.deselectRow(a.getAllRow())});a.mainBody.bind("click",{grid:a,name:"click"},this.processEvent);a.mainBody.bind("contextmenu",{grid:a,name:"contextmenu"},this.processEvent);
a.mainBodyWrap.bind("scroll",{grid:a,name:"scroll"},this.processEvent);a.bind("rowclick",function(c,d,e){if(c.ctrlKey&&d.cm[0].checkbox)b.toggleRow(e);else if(c.shiftKey&&d.cm[0].checkbox){c=d.findRowIndex(e);d=d.lastSelection?d.findRowIndex(d.lastSelection):c;b.selectRowRange(c,d)}else b.handlerClickRow(e)});a.bind("cellclick",function(c,d,e){b.handlerClickCell(e);b.onAutoEditClick(c,e)});a.bind("rowcontextmenu",function(c,d,e){b.onRowContextmenu(c,e)});a.bind("cellcontextmenu",function(c,d,e){b.onCellContextmenu(c,
e)});a.bind("checkboxclick",function(c,d,e){b.onCheckboxClick(c,d,e)});a.bind("bodyscroll",function(c,d){d.getSelectionModel().stopEditing()})}},processEvent:function(a){var b=f(a.target),c=a.data.grid,d=a.data.name;if(d=="scroll")c.triggerHandler("bodyscroll",[c],a);else{var e=c.findParentRow(b);c.findRowIndex(e);var g=c.findParentCell(b);c.findCellIndex(g);if(b.is(".grid-body-checkbox")||b.is(".grid-body-checkbox-th"))c.triggerHandler("checkbox"+d,[c,e],a);else{e&&c.triggerHandler("row"+d,[c,e],
a);g&&c.triggerHandler("cell"+d,[c,g],a)}}c.updateHeaderCheckbox()},onAutoEditClick:function(a,b){a=this.grid;var c=a.findParentRow(b);c=a.findRowIndex(c);b=a.findCellIndex(b);this.startEditing(c,b)},startEditing:function(a,b){this.stopEditing();var c=this.grid;c.cm[b]&&c.cm[b].editor&&f.defer(function(){this.activateEditor=c.cm[b].editor;var d=c.getCell(a,b),e=d.find(".grid-body-inner-span");d=c.getDataIndex(d[0]);c.cm[b].editor.startEdit(e,c.data.result[a][d]||"",{left:-c.cellBorder,top:-c.cellBorder})},
50,this)},stopEditing:function(){if(this.activateEditor){this.activateEditor.completeEdit();this.activateEditor=null}},onRowContextmenu:function(a,b){a.preventDefault();var c=grid.getContextMenu(),d=grid.getContextMenuSingle(),e=grid.getContextMenuMulti(),g=this;if(g.getSelections().length<2||!b.hasClass("grid-row-selected"))g.handlerClickRow(b);if(g.getSelections().length==1)if(d&&d.size()>0){g.applyContextRow(d,b);d.showAt(a.pageX,a.pageY)}else{if(c&&c.size()>0){g.applyContextRow(c,b);c.showAt(a.pageX,
a.pageY)}}else if(g.getSelections().length>1)if(e&&e.size()>0){g.applyContextRow(e,b);e.showAt(a.pageX,a.pageY)}else if(c&&c.size()>0){g.applyContextRow(c,b);c.showAt(a.pageX,a.pageY)}},onCellContextmenu:function(a,b){this.handlerClickCell(b)},addRowEvent:function(){},applyContextRow:function(a,b){a.contextRowEl=b;a.contextSelection=this.grid.getResult()[this.grid.findRowIndex(b)]},onCheckboxClick:function(a,b,c){a.stopPropagation();c.hasClass("grid-row-selected")?b.sm.deselectRow(c):b.sm.selectRow(c)},
selectRow:function(a){a.addClass("grid-row-selected").find(":checkbox.grid-body-checkbox").attr("checked",true);this.grid.lastSelection=a},deselectRow:function(a){a.removeClass("grid-row-selected").find(":checkbox.grid-body-checkbox").attr("checked",false)},toggleRow:function(a){a=a.toggleClass("grid-row-selected").find(":checkbox.grid-body-checkbox");a.attr("checked")?a.attr("checked",false):a.attr("checked",true)},selectRowRange:function(a,b){var c=this.grid.getAllRow();a-b>0?this.selectRow(c.slice(b,
a+1)):this.selectRow(c.slice(a,b+1))},handlerClickRow:function(a){this.selectRow(a);this.deselectRow(a.siblings())},select:function(a){a.addClass("grid-cell-selected")},deselect:function(a){a.removeClass("grid-cell-selected")},handlerClickCell:function(a){this.deselect(this.grid.mainBody.find("td"));this.select(a)},selectCell:function(a,b){this.handlerClickCell(this.grid.getCell(a,b))},getSelectedRow:function(){return this.grid.mainBody.find(".grid-row-selected")},getSelectedCell:function(){return this.grid.mainBody.find(".grid-cell-selected")},
getSelections:f.uiwidget.RowSelectionModel.prototype.getSelections,getCellSelections:f.uiwidget.CellSelectionModel.prototype.getSelections,handlerKeyDown:f.uiwidget.CellSelectionModel.prototype.handlerKeyDown,_goCells:f.uiwidget.CellSelectionModel.prototype.goCells,goCells:function(a,b,c){this._goCells(a,b,c);this.handlerClickRow(this.grid.getRow(a))},getSelectedRowIndex:function(){var a=this.grid.mainBody.children(".grid-row-selected");return a.length>0?this.grid.findRowIndex(a):null}});f.uiwidget.NoSelectionModel=
function(a){f.extend(this,a)};f.uiwidget.NoSelectionModel.prototype={initEvent:function(){var a=this;this.grid.getAllRow().each(function(){a.addRowEvent(f(this))})},addRowEvent:function(a){var b=this.grid;a.mouseover(function(){a.addClass("grid-row-over");b.triggerHandler("rowMouseOver",[b,a])});a.mouseout(function(){a.removeClass("grid-row-over");b.triggerHandler("rowMouseOut",[b,a])});a.click(function(){b.triggerHandler("rowClick",[b,a])})},getSelections:function(){return null},getSelectedRowIndex:function(){return null},
hasSelected:function(){return false},getSelectedRow:function(){return null}};f.uiwidget.SummaryBar=function(a){this.grid=a;this.render()};f.uiwidget.SummaryBar.prototype={render:function(){var a=this;this.grid.bind("afterRender",function(b,c){a.removeSummaryBar();a.renderSummaryBar();if(c.viewConfig&&c.viewConfig.horizontalScroll){a.summaryBar.wrapInner('<div class="grid-summary-bar-scroller"></div>');(b=c.mainBody.find(".grid-main").width())&&a.summaryBar.find(".grid-main").width(b)}})},renderSummaryBar:function(){this.summaryBar=
f('<div class="grid-summary-bar"><table class="grid-main" cellspacing="0" cellpadding="0"><tbody></tbody></table></div>');var a=this,b=this.grid;b.mainWrap.after(this.summaryBar);var c=[],d={};f.each(b.cm,function(e,g){if(!g.checkbox&&g.summaryConfig){if(g.summaryConfig.html)d[g.dataIndex]=g.summaryConfig.html;if(g.summaryConfig.calculation)for(e=0;e<b.getResult().length;e++)if(typeof g.summaryConfig.calculation=="string")d[g.dataIndex]=f.uiwidget.Calculations[g.summaryConfig.calculation].call(b,
d[g.dataIndex],g.dataIndex,e,b.getResult()[e])||0;else if(typeof g.summaryConfig.calculation=="function")d[g.dataIndex]=g.summaryConfig.calculation.call(b,d[g.dataIndex],g.dataIndex,e,b.getResult()[e])||0}});c.push("<tr>");f.each(b.cm,function(e,g){if(g.checkbox)c.push('<th unselectable="on"></th>');else{e=d[g.dataIndex];if(typeof e=="number")e=g.precision!=undefined?d[g.dataIndex].toFixed(g.precision):d[g.dataIndex].toFixed(f.uiwidget.Calculations.defPrecision);c.push('<td class="grid-summary-bar-',
g.dataIndex,'" hidefocus="true" width="',g.width,'" tabindex="1">');/<.*>/.exec(e)?c.push('<span unselectable="on" class="grid-body-inner-span">'):c.push('<span unselectable="on" class="grid-body-inner-span" title="',e,'">');e==null||e==undefined||typeof e=="string"&&e.length<1?c.push("&#160;"):c.push(e);c.push("</span></td>")}});c.push("</tr>");this.summaryBar.find("tbody").append(c.join(""));b.bind("bodyscroll",function(e,g,h){a.summaryBar.scrollLeft(h)})},removeSummaryBar:function(){this.summaryBar&&
this.summaryBar.remove()},update:function(){this.removeSummaryBar();this.renderSummaryBar()},getValue:function(a){return this.summaryBar.find(".grid-summary-bar-"+a+" .grid-body-inner-span").attr("title")},setValue:function(a,b){a=this.summaryBar.find(".grid-summary-bar-"+a+" .grid-body-inner-span");a.attr("title",b);a.html(b)}};f.uiwidget.PageToolbar=function(){};f.uiwidget.PageToolbar.prototype={renderToolbar:function(){var a=['<div class="grid-bottom-toolbar" cellpadding="0" cellspacing="0">'];
if(this.grid.pageSizeList){for(var b=['<div class="page-size-list"><span class="page-size-list-text">',this.grid.pageSizeListText,'</span><select class="page-size-list-select">'],c=0;c<this.grid.pageSizeList.length;c++)b.push("<option value=",this.grid.pageSizeList[c],this.grid.pageSize&&this.grid.pageSize==this.grid.pageSizeList[c]?" selected":"",">",this.grid.pageSizeList[c],"</option>");b.push("</select></div>");a=a.concat(b)}a=a.concat(['<div class="display-text">',this.getDisplayText(0,0,0),
"</div>",'<div class="page-navigator"><table border="0" cellspacing="0" cellpadding="0">','<tr align="center">','<td width="18"><input type="button" class="page-first" title="',this.grid.firstText,'"/></td>','  <td width="18"><input type="button" class="page-pre" title="',this.grid.prevText,'"/></td>','  <td width="18"><input type="button" class="page-next" title="',this.grid.nextText,'"/></td>','  <td width="18"><input type="button" class="page-last" title="',this.grid.lastText,'"/></td>','  <td width="10"  class="page-seperator">|</td>',
'  <td width="48">',this.grid.pageNumberText,"</td>",'\t<td width="20"><input class="page-number" type="text" value="1"/></td>','  <td width="10">/</td>','  <td width="15"><span class="total-page-size">1</span></td>',' \t<td width="50">',this.getJumperButtonHtml(),"</td>","</tr>"," </table></div>","</div>"]);this.toolbar=f(a.join(""));this.grid.container.append(this.toolbar);var d=this;this.getPageNextEl().click(function(){var e=parseInt(d.getPageNumberEl().val());e<parseInt(d.getTotalPageSizeEl().html())&&
d.grid.goPage(e+1)});this.getPagePreEl().click(function(){var e=parseInt(d.getPageNumberEl().val());e>1&&d.grid.goPage(--e)});this.getPageFirstEl().click(function(){parseInt(d.getPageNumberEl().val())>1&&d.grid.goPage(1)});this.getPageLastEl().click(function(){var e=parseInt(d.getPageNumberEl().val()),g=parseInt(d.getTotalPageSizeEl().html());e<g&&d.grid.goPage(g)});this.addJumperButtonEvent();this.getPageNumberEl().keydown(function(e){e.stopPropagation();e.which==13&&d.handlerPageNumberEvent(f(this))}).focus(function(){f(this).select()});
this.getPageSizeSelectEl().change(function(){d.grid.setPageSize(this.value);d.grid.goPage(1)});this.addPageElHoverEvent(this.getPageFirstEl(),"first");this.addPageElHoverEvent(this.getPagePreEl(),"pre");this.addPageElHoverEvent(this.getPageNextEl(),"next");this.addPageElHoverEvent(this.getPageLastEl(),"last")},getJumperButtonHtml:function(){return['<div class="grid-btn-order"><ul><li class="left-normal"></li><li class="middle-normal">',this.grid.jumperText,'</li><li class="right-normal"></li></ul></div>'].join("")},
addJumperButtonEvent:function(){var a=this;this.toolbar.find("li.middle-normal").hover(function(){f(this).prev().addClass("left-over");f(this).addClass("middle-over");f(this).next().addClass("right-over")},function(){f(this).prev().removeClass("left-over");f(this).removeClass("middle-over");f(this).next().removeClass("right-over")}).click(function(){a.handlerPageNumberEvent(a.getPageNumberEl())})},updateToolbar:function(){var a=this.grid.pageSize,b=this.grid.data.totalCount||this.grid.data.result.length,
c=this.grid.paras.start,d=c+this.grid.data.result.length,e=c/a+1;a=parseInt((b==0?b:b-1)/a)+1;b=this.grid.data.result.length>0?this.getDisplayText(c+1,d,b):this.grid.emptyMsg;this.getPageNumberEl().val(e);this.setDisplayText(b);this.getTotalPageSizeEl().html(a);if(e==1){this.getPageFirstEl().addClass("page-first-disabled");this.getPagePreEl().addClass("page-pre-disabled")}else{this.getPageFirstEl().removeClass("page-first-disabled");this.getPagePreEl().removeClass("page-pre-disabled")}if(e==a){this.getPageNextEl().addClass("page-next-disabled");
this.getPageLastEl().addClass("page-last-disabled")}else{this.getPageNextEl().removeClass("page-next-disabled");this.getPageLastEl().removeClass("page-last-disabled")}},format:function(a){var b=Array.prototype.slice.call(arguments,1);if(!a)throw"format is null";return a.replace(/\{(\d+)\}/g,function(c,d){return b[d]})},setDisplayText:function(a){this.getDisplayTextEl().html(a)},getDisplayText:function(a,b,c){return this.format(this.grid.displayMsg,'<span class="record-start">'+a+"</span>",'<span class="record-end">'+
b+"</span>",'<span class="record-amount">'+c+"</span>")},addPageElHoverEvent:function(a,b){a.hover(function(){a.hasClass("page-"+b+"-disabled")||a.addClass("page-"+b+"-over")},function(){a.removeClass("page-"+b+"-over")})},getPageNumberEl:function(){return this.pageNumberEl||(this.pageNumberEl=this.toolbar.find(":input.page-number"))},getDisplayTextEl:function(){return this.displayTextEl||(this.displayTextEl=this.toolbar.find(".display-text"))},getTotalPageSizeEl:function(){return this.totalPageSizeEl||
(this.totalPageSizeEl=this.toolbar.find(".total-page-size"))},getPageFirstEl:function(){return this.pageFirstEl||(this.pageFirstEl=this.toolbar.find(".page-first"))},getPagePreEl:function(){return this.pagePreEl||(this.pagePreEl=this.toolbar.find(".page-pre"))},getPageNextEl:function(){return this.pageNextEl||(this.pageNextEl=this.toolbar.find(".page-next"))},getPageLastEl:function(){return this.pageLastEl||(this.pageLastEl=this.toolbar.find(".page-last"))},getPageSizeSelectEl:function(){return this.pageSizeSelectEl||
(this.pageSizeSelectEl=this.toolbar.find(".page-size-list-select"))},handlerPageNumberEvent:function(a){var b=parseInt(a[0].value);if(!isNaN(b)){var c=parseInt(this.getTotalPageSizeEl().html());if(b>c){this.grid.goPage(c);a.val(c)}else if(b<=0){this.grid.goPage(1);a.val(1)}else this.grid.goPage(b)}}};f.uiwidget.ComplexPageToolbar=function(){};f.uiwidget.ComplexPageToolbar.prototype={displayMsg:"\u5171{0}\u6761\uff0c\u663e\u793a{1}-{2}\u6761",jumperMsg:"\u8df3\u9875",prevText:"&lt;&lt;",nextText:"&gt;&gt;",
pageSizeListText:"\uff0c\u663e\u793a\u6761\u6570\uff1a",renderToolbar:function(){var a=['<div class="grid-bottom-ctoolbar"><ul><li class="display-text">\u5171<span class="bold">0</span>\u6761\uff0c\u663e\u793a<span class="bold">0</span>-<span class="bold">0</span>\u6761</li>'];if(this.grid.pageSizeList){for(var b=['<li class="page-size-list">',this.pageSizeListText,'<select class="page-size-list-select">'],c=0;c<this.grid.pageSizeList.length;c++)b.push("<option value=",this.grid.pageSizeList[c],this.grid.pageSize&&
this.grid.pageSize==this.grid.pageSizeList[c]?" selected":"",">",this.grid.pageSizeList[c],"</option>");b.push("</select></li>");a=a.concat(b)}a=a.concat(['<li class="display-line">&#160;</li><li class="nav">','<li><input type="text" class="page-number" value="',this.jumperMsg,'" /></li>',"</div>"]);this.toolbar=f(a.join(""));this.grid.container.append(this.toolbar);var d=this.grid,e=this;this.getNavEl().bind("click",{toolbar:this},function(g){var h=f(g.target),i=g.data.toolbar,j=h.html();pageNum=
h.children(".first-ellipsis").length>0||h.is(".first-ellipsis")?1:h.children(".last-ellipsis").length>0||h.is(".last-ellipsis")?i.totalPageSize:j==i.nextText?i.pageNum+1:j==i.prevText?i.pageNum-1:Number(h.html());d.triggerHandler("toolbarPagenumClick",[d,h,pageNum],g)});this.getPageNumberEl().focus(function(){f(this).val()==e.jumperMsg&&f(this).val("")}).blur(function(){f(this).val()==""&&f(this).val(e.jumperMsg)}).keydown(function(g){g.stopPropagation();g.which==13&&e.handlerPageNumberEvent(f(this))});
this.getPageSizeSelectEl().change(function(){e.grid.setPageSize(this.value);e.grid.goPage(1)});d.bind("toolbarPagenumClick",function(g,h,i,j){h.goPage(j)})},updateToolbar:function(){var a=this.grid.pageSize,b=this.grid.data.totalCount||this.grid.data.result.length,c=this.grid.paras.start,d=c+this.grid.data.result.length;this.pageNum=c/a+1;this.totalPageSize=parseInt((b==0?b:b-1)/a)+1;this.setDisplayText(this.grid.data.result.length>0?this.getDisplayText(c+1,d,b):this.grid.emptyMsg);this.updatePageNav()},
updatePageNav:function(){var a=[];if(this.totalPageSize==1){this.getPageNumberEl().hide();this.getDisplayLineEl().hide();this.getNavEl().empty()}else{if(this.totalPageSize<=5){if(this.pageNum!=1)a=this.renderPrevPage(a);for(var b=0;b<this.totalPageSize;b++)a=this.pageNum==b+1?this.renderCurrent(b+1,a):this.renderPage(b+1,a);if(this.pageNum!=this.totalPageSize)a=this.renderNextPage(a)}else{if(this.pageNum==1){from=1;to=5}else if(this.totalPageSize-this.pageNum>3){from=this.pageNum-1;to=this.pageNum+
3}else{to=this.totalPageSize;from=to-4}if(from!=1)a=this.renderFirstPage(a);if(this.pageNum!=1)a=this.renderPrevPage(a);for(b=from;b<to+1;b++)a=this.pageNum==b?this.renderCurrent(this.pageNum,a):this.renderPage(b,a);if(this.pageNum!=this.totalPageSize)a=this.renderNextPage(a);if(to!=this.totalPageSize)a=this.renderLastPage(this.totalPageSize,a)}this.getPageNumberEl().show();this.getDisplayLineEl().show();this.getNavEl().empty().append(a.join(""))}},renderCurrent:function(a,b){return b=b.concat(['<span class="current">',
a,"</span>"])},renderPage:function(a,b){return b=b.concat(['<a href="javascript:void(0)" class="page" hidefocus="true">',a,"</a>"])},renderPrevPage:function(a){return this.renderPage(this.prevText,a)},renderNextPage:function(a){return this.renderPage(this.nextText,a)},renderFirstPage:function(a){return a=a.concat(['<a href="javascript:void(0)" class="page" hidefocus="true">',1,'<span class="ellipsis first-ellipsis">...</span></a>'])},renderLastPage:function(a,b){return b=b.concat(['<a href="javascript:void(0)" class="page" hidefocus="true"><span class="ellipsis last-ellipsis">...</span>',
a,"</a>"])},format:function(a){var b=Array.prototype.slice.call(arguments,1);if(!a)throw"format is null";return a.replace(/\{(\d+)\}/g,function(c,d){return b[d]})},setDisplayText:function(a){this.getDisplayTextEl().html(a)},getDisplayText:function(a,b,c){return this.format(this.displayMsg,'<span class="bold">'+c+"</span>",'<span class="bold">'+a+"</span>",'<span class="bold">'+b+"</span>")},handlerPageNumberEvent:function(a){var b=parseInt(a[0].value);if(!isNaN(b))if(b>this.totalPageSize){this.grid.goPage(this.totalPageSize);
a.val(this.totalPageSize)}else if(b<=0){this.grid.goPage(1);a.val(1)}else this.grid.goPage(b)},getPageNumberEl:function(){return this.pageNumberEl||(this.pageNumberEl=this.toolbar.find(":input.page-number"))},getDisplayTextEl:function(){return this.displayTextEl||(this.displayTextEl=this.toolbar.find(".display-text"))},getNavEl:function(){return this.navEl||(this.navEl=this.toolbar.find(".nav"))},getPageSizeSelectEl:function(){return this.pageSizeSelectEl||(this.pageSizeSelectEl=this.toolbar.find(".page-size-list-select"))},
getDisplayLineEl:function(){return this.displayLineEl||(this.displayLineEl=this.toolbar.find(".display-line"))}};f.uiwidget.Calculations={defPrecision:2,sum:function(a,b,c,d){b=Number(d[b]);if(!isNaN(b))return b+(a||0)},max:function(a,b,c,d){b=Number(d[b]);if(!isNaN(b))return(a||0)<b?b:a||0},min:function(a,b,c,d){b=Number(d[b]);if(!isNaN(b))return(a||b)<b?a||b:b},count:function(a){return(a||0)+1},average:function(a,b,c,d){b=Number(d[b]);if(!isNaN(b))return((a||0)*c+b)/(c+1)}};f.extend({accAdd:function(a,
b){try{a.toString().split(".")}catch(c){}try{b.toString().split(".")}catch(d){}return(parseInt(a*void 0)+parseInt(b*void 0))/void 0},accMin:function(a,b){var c,d;try{c=a.toString().split(".")[1].length}catch(e){c=0}try{d=b.toString().split(".")[1].length}catch(g){d=0}c=Math.pow(10,Math.max(c,d));return(parseInt(a*c)-parseInt(b*c))/c},accMul:function(a,b){var c=0;a=a.toString();b=b.toString();try{c+=a.split(".")[1].length}catch(d){}try{c+=b.split(".")[1].length}catch(e){}return Number(a.replace(".",
""))*Number(b.replace(".",""))/Math.pow(10,c)},accDiv:function(a,b){var c=0,d=0;try{c=a.toString().split(".")[1].length}catch(e){}try{d=b.toString().split(".")[1].length}catch(g){}a=Number(a.toString().replace(".",""));b=Number(b.toString().replace(".",""));return f.accMul(a/b,Math.pow(10,d-c))}});f.uiwidget.RowNumberer={header:"&#160;",sortable:false,dataIndex:"gridRowNumberer",width:"25px",renderer:function(a,b,c){return c+1}};f.uiwidget.PageRowNumberer={header:"&#160;",sortable:false,dataIndex:"gridPageRowNumberer",
width:"25px",renderer:function(a,b,c,d,e,g){return(g.getPageNumber()-1)*g.getPageSize()+c+1}};f.fn.grid=function(a){return new f.uiwidget.Grid(this,a)};f.createDelegate=function(a,b,c,d){return function(){var e=c||arguments;if(d===true){e=Array.prototype.slice.call(arguments,0);e=e.concat(c)}else if(typeof d=="number"){e=Array.prototype.slice.call(arguments,0);var g=[d,0].concat(c);Array.prototype.splice.apply(e,g)}return a.apply(b||window,e)}};f.defer=function(a,b,c,d,e){a=f.createDelegate(a,c,d,
e);if(b)return setTimeout(a,b);a();return 0};f.uiwidget.GridRowBuilder=f.uiwidget.Class.create({buildRow:function(a,b){var c=[];c.push('<div class="grid-row"><table class="grid-main" cellspacing="0" cellpadding="0"><tbody><tr>');for(var d=0;d<this.grid.cm.length;d++){var e=this.grid.cm[d];if(e.checkbox)c.push('<th class="grid-body-checkbox-th">',b?'<input type="checkbox" class="grid-body-checkbox" value=""/>':"","</th>");else{var g=b[e.dataIndex];if(typeof g=="number"&&e.precision)g=b[e.dataIndex].toFixed(e.precision);
var h={};h.css=["grid-cm-",e.dataIndex," grid-cell-",e.dataIndex].join("");if(e.renderer)g=e.renderer(g,b,a,d,h,this.grid);c.push('<td hidefocus="true" style="width:',e.width,'" class="',h.css,' grid-row-td" title="',h.title,'" tabindex="-1">');if(/<.*>/.exec(g))c.push('<span class="grid-body-inner-span">');else{e=null;e=!b||g==null||g==undefined||typeof g=="string"&&g.length<1?"":typeof g=="string"?g.replace(/\"/g,"&quot;"):g;c.push('<span unselectable="on" class="grid-body-inner-span" title="',
e,'">')}c.push(g);c.push("</span></td>")}}c.push("</tr></tbody></table></div>");return c}})})(jQuery);
